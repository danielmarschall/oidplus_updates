<?php /* <ViaThinkSoftSignature>
UyIKpex3kfd/0BstbLDSgQ4rYv0+hN08ff6WQBgRNO3b0H7mQfPJ9nFxHSF8MDJAU
ILT68NDfbMAl+S5BuzGuFvm/z8N+TeWT6nwRLWGLLjNEQGbizqe+jZnSOlWxm9lQI
r1p4mFNdc0rqUTKN0fi2I+MDse4hCIYZIEEbKB7XTbuxnk9WE0Rm6oNxLhiL20Wy3
V4fOTvj/k78CONCE/CiSu7cDNuFLnwmOYHBRamuqmjH9Dir2Y+ubbmpqYAWD0U2KK
fdx/S0bSOInQGxAE302d4tdT6BfPTCf78xZpGqiCdC7aPzf2T+0y2WAg8qXvQJbpT
avxR4FLIWkdsqtBZDByIm1Kt/HJpJ8P7q3RkXvr1e6BeFV/Bk1pQkWcva2Ero0zWF
S4UWnuEmv+fgdaGEsj3GX1zBESy3nFbiQG8qcvhTtB462Jw6tPH9DNOzlhjliaXN3
eBwGy6MCN4UEwfFqjySYt5S1e8HEhAAB4c/ZVn3+uKmcvsUszgnm0F/yEpIhbZS5P
yO4b5S+GUP1Xg+YkwIwZ0LD9XkJhJi1PMa9NcrEFMPiB8hPgEG35aFkkvMrqOb9YA
lgKFkscWZ0U9MGKKUzn7SLbD8c3GMmaxtBnvTj89szgLPQreQfd9Qd3SjKL6ZYlhV
NXRK071FROKQ4qqCeXE0qdq0aMYtgK5lspVOiwo+ZpdZ0f0bpMrzvqWeDqgqnwG/e
c//Pe628ddBEqTTDVM1JiLcBu8nivvYUC4JZtHx1733cJAPbGJFDKFW0ktvTtC68R
+G/Io52w+Q4E4eTnMMiunHCrCO41Q+/4Hf2jezpNtcEht7trtPz3x+K/D31q1tiMw
ECtA/4zKMKPb9yQjP5a3KuG7kcfczHL88z6CK6b7o4Hw8UkQAvxP1xPi9t7lQJS+g
HgmW+cWYI4sll/XRMLgf8kdTHvQsyI7aNZPxXKtWSt/5dUusAnlYEEyq3+loMaCtu
9co+y/TOQvmANm1uZ12ZBDSCatXW+dsepXJHXonIZ60R9s6gGoX2RR6zKsYFOqK9i
nl87waMmIgOH4+Os0+eDEiaC/ROJpplyR6wR/xhxFH7jkCJokGIjjR567atke57Oc
/XkjE6lHsa6OYaGXLdXqMlFeS9RvTzf1mR3jWOOQ+aFn5vpndmD2ygwh4Xaf3fVNg
SS8PsMPUn2Dy2t7RVXMSjhTjD820a9ugy/c5ry05za9FyGEBUpLSex7lKy9eioOLE
rXSsqa1TFuyPzlYZRGRgQU1mdEgCISSktzRMGwlIxWUYKkGh4wEsLL/dRhnKUPHfy
/XxofTrvQxN2wCcIC39XpysurEDKb2mT7S2z+PmcjWha0AUyW/2FevaTUSKIh7J//
Q==
</ViaThinkSoftSignature> */ ?>
<?php

/*
 * OIDplus 2.0
 * Copyright 2019 - 2023 Daniel Marschall, ViaThinkSoft
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

function info($str) { echo "INFO: $str\n"; }
function warn($str) { echo "WARNING: $str\n"; }
function err($str) { die("FATAL ERROR: $str\n"); }

@set_time_limit(0);

@header('Content-Type: text/plain');

chdir(__DIR__);
if (trim(@file_get_contents('.version.php')) !== '<?php // Revision 711') {
	err('This update can only be applied to OIDplus version 2.0.0.711!');
}

if (version_compare(PHP_VERSION, '7.0.0') < 0) {
	err('You need PHP Version 7.0 to update to this version');
}

// Files different: includes/classes/OIDplusAuthUtils.class.php
function writefile_1() {
	@$fp = fopen('includes/classes/OIDplusAuthUtils.class.php', 'w');
	@fwrite($fp, base64_decode('PD9waHAKCi8qCiAqIE9JRHBsdXMgMi4wCiAqIENvcHlyaWdodCAyMDE5IC0gMjAyMSBEYW5pZWwgTWFyc2NoYWxsLCBWaWFUaGlua1NvZnQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7'));
	@fwrite($fp, base64_decode('CiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAqCiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5z'));
	@fwrite($fp, base64_decode('ZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMi'));
	@fwrite($fp, base64_decode('IEJBU0lTLAogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25z'));
	@fwrite($fp, base64_decode('IGFuZAogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICovCgppZiAoIWRlZmluZWQoJ0lOU0lERV9PSURQTFVTJykpIGRpZSgpOwoKY2xhc3MgT0lEcGx1c0F1dGhVdGlscyB7CgoJLy8gVXNlZnVsIGZ1bmN0aW9ucwoKCXB1YmxpYyBzdGF0aWMgZnVu'));
	@fwrite($fp, base64_decode('Y3Rpb24gZ2V0UmFuZG9tQnl0ZXMoJGxlbikgewoJCWlmIChmdW5jdGlvbl9leGlzdHMoJ29wZW5zc2xfcmFuZG9tX3BzZXVkb19ieXRlcycpKSB7CgkJCSRhID0gb3BlbnNzbF9yYW5kb21fcHNldWRvX2J5dGVzKCRsZW4pOwoJCQlpZiAoJGEpIHJldHVybiAkYTsK'));
	@fwrite($fp, base64_decode('CQl9CgoJCWlmIChmdW5jdGlvbl9leGlzdHMoJ21jcnlwdF9jcmVhdGVfaXYnKSkgewoJCQkkYSA9IGJpbjJoZXgobWNyeXB0X2NyZWF0ZV9pdigkbGVuLCBNQ1JZUFRfREVWX1VSQU5ET00pKTsKCQkJaWYgKCRhKSByZXR1cm4gJGE7CgkJfQoKCQlpZiAoZnVuY3Rp'));
	@fwrite($fp, base64_decode('b25fZXhpc3RzKCdyYW5kb21fYnl0ZXMnKSkgewoJCQkkYSA9IHJhbmRvbV9ieXRlcygkbGVuKTsKCQkJaWYgKCRhKSByZXR1cm4gJGE7CgkJfQoKCQkvLyBGYWxsYmFjayB0byBub24tc2VjdXJlIFJORwoJCSRhID0gJyc7CgkJd2hpbGUgKHN0cmxlbigkYSkgPCAk'));
	@fwrite($fp, base64_decode('bGVuKjIpIHsKCQkJJGEgLj0gc2hhMSh1bmlxaWQoKHN0cmluZyltdF9yYW5kKCksIHRydWUpKTsKCQl9CgkJJGEgPSBzdWJzdHIoJGEsIDAsICRsZW4qMik7CgkJcmV0dXJuIGhleDJiaW4oJGEpOwoJfQoKCXByaXZhdGUgc3RhdGljIGZ1bmN0aW9uIHJhUGVwcGVy'));
	@fwrite($fp, base64_decode('UHJvY2Vzc2luZyhzdHJpbmcgJHBhc3N3b3JkKTogc3RyaW5nIHsKCQkvLyBBZGRpdGlvbmFsIGZlYXR1cmU6IFBlcHBlcgoJCS8vIFRoZSBwZXBwZXIgaXMgc3RvcmVkIGluc2lkZSB0aGUgYmFzZSBjb25maWd1cmF0aW9uIGZpbGUKCQkvLyBJdCBwcmV2ZW50cyB0'));
	@fwrite($fp, base64_decode('aGF0IGFuIGF0dGFja2VyIHdpdGggU1FMIHdyaXRlIHJpZ2h0cyBjYW4KCQkvLyBjcmVhdGUgYWNjb3VudHMuCgkJLy8gQVRURU5USU9OISEhIElmIGEgcGVwcGVyIGlzIHVzZWQsIHRoZW4gdGhlCgkJLy8gaGFzaGVzIGFyZSBib3VuZCB0byB0aGF0IHBlcHBlci4g'));
	@fwrite($fp, base64_decode('SWYgeW91IGNoYW5nZSB0aGUgcGVwcGVyLAoJCS8vIHRoZW4gQUxMIHBhc3N3b3JkcyBvZiBSQXMgYmVjb21lIElOVkFMSUQhCgkJJHBlcHBlciA9IE9JRHBsdXM6OmJhc2VDb25maWcoKS0+Z2V0VmFsdWUoJ1JBX1BBU1NXT1JEX1BFUFBFUicsJycpOwoJCWlmICgk'));
	@fwrite($fp, base64_decode('cGVwcGVyICE9PSAnJykgewoJCQkkYWxnbyA9IE9JRHBsdXM6OmJhc2VDb25maWcoKS0+Z2V0VmFsdWUoJ1JBX1BBU1NXT1JEX1BFUFBFUl9BTEdPJywnc2hhNTEyJyk7IC8vIHNoYTUxMiB3b3JrcyB3aXRoIFBIUCA3LjAKCQkJaWYgKHN0cnRvbG93ZXIoJGFsZ28p'));
	@fwrite($fp, base64_decode('ID09PSAnc2hhMy01MTInKSB7CgkJCQkkaG1hYyA9IHNoYTNfNTEyX2htYWMoJHBhc3N3b3JkLCAkcGVwcGVyKTsKCQkJfSBlbHNlIHsKCQkJCSRobWFjID0gaGFzaF9obWFjKCRhbGdvLCAkcGFzc3dvcmQsICRwZXBwZXIpOwoJCQl9CgkJCWlmICgkaG1hYyA9PT0g'));
	@fwrite($fp, base64_decode('ZmFsc2UpIHRocm93IG5ldyBPSURwbHVzRXhjZXB0aW9uKF9MKCdITUFDIGZhaWxlZCcpKTsKCQkJcmV0dXJuICRobWFjOwoJCX0gZWxzZSB7CgkJCXJldHVybiAkcGFzc3dvcmQ7CgkJfQoJfQoKCS8vIENvbnRlbnQgcHJvdmlkZXIKCglwdWJsaWMgZnVuY3Rpb24g'));
	@fwrite($fp, base64_decode('Z2V0QXV0aE1ldGhvZCgpIHsKCQkkYWNzID0gJHRoaXMtPmdldEF1dGhDb250ZW50U3RvcmUoKTsKCQlpZiAoaXNfbnVsbCgkYWNzKSkgcmV0dXJuICdudWxsJzsKCQlyZXR1cm4gZ2V0X2NsYXNzKCRhY3MpOwoJfQoKCXByb3RlY3RlZCBmdW5jdGlvbiBnZXRBdXRo'));
	@fwrite($fp, base64_decode('Q29udGVudFN0b3JlKCkgewoJCS8vIExvZ2dlZCBpbiB2aWEgSldUCgkJJHRtcCA9IE9JRHBsdXNBdXRoQ29udGVudFN0b3JlSldUOjpnZXRBY3RpdmVQcm92aWRlcigpOwoJCWlmICgkdG1wKSByZXR1cm4gJHRtcDsKCgkJLy8gTm9ybWFsIGxvZ2luIHZpYSB3ZWIt'));
	@fwrite($fp, base64_decode('YnJvd3NlcgoJCS8vIENvb2tpZSB3aWxsIG9ubHkgYmUgY3JlYXRlZCBvbmNlIGNvbnRlbnQgaXMgc3RvcmVkCgkJJHRtcCA9IE9JRHBsdXNBdXRoQ29udGVudFN0b3JlU2Vzc2lvbjo6Z2V0QWN0aXZlUHJvdmlkZXIoKTsKCQlpZiAoJHRtcCkgcmV0dXJuICR0bXA7'));
	@fwrite($fp, base64_decode('CgoJCS8vIE5vIGFjdGl2ZSBzZXNzaW9uIGFuZCBubyBKV1QgdG9rZW4gYXZhaWxhYmxlLiBVc2VyIGlzIG5vdCBsb2dnZWQgaW4uCgkJcmV0dXJuIG51bGw7Cgl9CgoJcHVibGljIGZ1bmN0aW9uIGdldEV4dGVuZGVkQXR0cmlidXRlKCRuYW1lLCAkZGVmYXVsdD1O'));
	@fwrite($fp, base64_decode('VUxMKSB7CgkJJGFjcyA9ICR0aGlzLT5nZXRBdXRoQ29udGVudFN0b3JlKCk7CgkJaWYgKGlzX251bGwoJGFjcykpIHJldHVybiAkZGVmYXVsdDsKCQlyZXR1cm4gJGFjcy0+Z2V0VmFsdWUoJG5hbWUsICRkZWZhdWx0KTsKCX0KCgkvLyBSQSBhdXRoZW50aWNhdGlv'));
	@fwrite($fp, base64_decode('biBmdW5jdGlvbnMKCglwdWJsaWMgZnVuY3Rpb24gcmFMb2dpbigkZW1haWwpIHsKCQkkYWNzID0gJHRoaXMtPmdldEF1dGhDb250ZW50U3RvcmUoKTsKCQlpZiAoaXNfbnVsbCgkYWNzKSkgcmV0dXJuOwoJCXJldHVybiAkYWNzLT5yYUxvZ2luKCRlbWFpbCk7Cgl9'));
	@fwrite($fp, base64_decode('CgoJcHVibGljIGZ1bmN0aW9uIHJhTG9nb3V0KCRlbWFpbCkgewoJCSRhY3MgPSAkdGhpcy0+Z2V0QXV0aENvbnRlbnRTdG9yZSgpOwoJCWlmIChpc19udWxsKCRhY3MpKSByZXR1cm47CgkJcmV0dXJuICRhY3MtPnJhTG9nb3V0KCRlbWFpbCk7Cgl9CgoJcHVibGlj'));
	@fwrite($fp, base64_decode('IGZ1bmN0aW9uIHJhQ2hlY2tQYXNzd29yZCgkcmFfZW1haWwsICRwYXNzd29yZCkgewoJCSRyYSA9IG5ldyBPSURwbHVzUkEoJHJhX2VtYWlsKTsKCgkJLy8gR2V0IFJBIGluZm8gZnJvbSBSQQoJCSRhdXRoSW5mbyA9ICRyYS0+Z2V0QXV0aEluZm8oKTsKCQlpZiAo'));
	@fwrite($fp, base64_decode('ISRhdXRoSW5mbykgcmV0dXJuIGZhbHNlOyAvLyB1c2VyIG5vdCBmb3VuZAoKCQkvLyBBc2sgcGx1Z2lucyBpZiB0aGV5IGNhbiB2ZXJpZnkgdGhpcyBoYXNoCgkJJHBsdWdpbnMgPSBPSURwbHVzOjpnZXRBdXRoUGx1Z2lucygpOwoJCWlmIChjb3VudCgkcGx1Z2lu'));
	@fwrite($fp, base64_decode('cykgPT0gMCkgewoJCQl0aHJvdyBuZXcgT0lEcGx1c0V4Y2VwdGlvbihfTCgnTm8gUkEgYXV0aGVudGljYXRpb24gcGx1Z2lucyBmb3VuZCcpKTsKCQl9CgkJZm9yZWFjaCAoJHBsdWdpbnMgYXMgJHBsdWdpbikgewoJCQlpZiAoJHBsdWdpbi0+dmVyaWZ5KCRhdXRo'));
	@fwrite($fp, base64_decode('SW5mbywgc2VsZjo6cmFQZXBwZXJQcm9jZXNzaW5nKCRwYXNzd29yZCkpKSByZXR1cm4gdHJ1ZTsKCQl9CgoJCXJldHVybiBmYWxzZTsKCX0KCglwdWJsaWMgZnVuY3Rpb24gcmFOdW1Mb2dnZWRJbigpIHsKCQkkYWNzID0gJHRoaXMtPmdldEF1dGhDb250ZW50U3Rv'));
	@fwrite($fp, base64_decode('cmUoKTsKCQlpZiAoaXNfbnVsbCgkYWNzKSkgcmV0dXJuIDA7CgkJcmV0dXJuICRhY3MtPnJhTnVtTG9nZ2VkSW4oKTsKCX0KCglwdWJsaWMgZnVuY3Rpb24gbG9nZ2VkSW5SYUxpc3QoKSB7CgkJaWYgKCR0aGlzLT5mb3JjZUFsbExvZ2dlZE91dCgpKSB7CgkJCXJl'));
	@fwrite($fp, base64_decode('dHVybiBhcnJheSgpOwoJCX0gZWxzZSB7CgkJCSRhY3MgPSAkdGhpcy0+Z2V0QXV0aENvbnRlbnRTdG9yZSgpOwoJCQlpZiAoaXNfbnVsbCgkYWNzKSkgcmV0dXJuIGFycmF5KCk7CgkJCXJldHVybiAkYWNzLT5sb2dnZWRJblJhTGlzdCgpOwoJCX0KCX0KCglwdWJs'));
	@fwrite($fp, base64_decode('aWMgZnVuY3Rpb24gaXNSYUxvZ2dlZEluKCRlbWFpbCkgewoJCSRhY3MgPSAkdGhpcy0+Z2V0QXV0aENvbnRlbnRTdG9yZSgpOwoJCWlmIChpc19udWxsKCRhY3MpKSByZXR1cm4gZmFsc2U7CgkJcmV0dXJuICRhY3MtPmlzUmFMb2dnZWRJbigkZW1haWwpOwoJfQoK'));
	@fwrite($fp, base64_decode('CS8vICJIaWdoIGxldmVsIiBmdW5jdGlvbiBpbmNsdWRpbmcgbG9nZ2luZyBhbmQgY2hlY2tpbmcgZm9yIHZhbGlkIEpXVCBhbHRlcm5hdGlvbnMKCXB1YmxpYyBmdW5jdGlvbiByYUxvZ2luRXgoJGVtYWlsLCAkcmVtZW1iZXJfbWUsICRvcmlnaW49JycpIHsKCQkk'));
	@fwrite($fp, base64_decode('bG9naW5mbyA9ICcnOwoJCSRhY3MgPSAkdGhpcy0+Z2V0QXV0aENvbnRlbnRTdG9yZSgpOwoJCWlmICghaXNfbnVsbCgkYWNzKSkgewoJCQkkYWNzLT5yYUxvZ2luRXgoJGVtYWlsLCAkbG9naW5mbyk7CgkJCSRhY3MtPmFjdGl2YXRlKCk7CgkJfSBlbHNlIHsKCQkJ'));
	@fwrite($fp, base64_decode('aWYgKCRyZW1lbWJlcl9tZSkgewoJCQkJaWYgKCFPSURwbHVzOjpiYXNlQ29uZmlnKCktPmdldFZhbHVlKCdKV1RfQUxMT1dfTE9HSU5fVVNFUicsIHRydWUpKSB7CgkJCQkJdGhyb3cgbmV3IE9JRHBsdXNFeGNlcHRpb24oX0woJ1RoZSBhZG1pbmlzdHJhdG9yIGhh'));
	@fwrite($fp, base64_decode('cyBkaXNhYmxlZCB0aGlzIGZlYXR1cmUuIChCYXNlIGNvbmZpZ3VyYXRpb24gc2V0dGluZyAlMSkuJywnSldUX0FMTE9XX0xPR0lOX1VTRVInKSk7CgkJCQl9CgkJCQkkdHRsID0gT0lEcGx1czo6YmFzZUNvbmZpZygpLT5nZXRWYWx1ZSgnSldUX1RUTF9MT0dJTl9V'));
	@fwrite($fp, base64_decode('U0VSJywgMTAqMzY1KjI0KjYwKjYwKTsKCQkJCSRhdXRoU2ltdWxhdGlvbiA9IG5ldyBPSURwbHVzQXV0aENvbnRlbnRTdG9yZUpXVCgpOwoJCQkJJGF1dGhTaW11bGF0aW9uLT5yYUxvZ2luRXgoJGVtYWlsLCAkbG9naW5mbyk7CgkJCQkkYXV0aFNpbXVsYXRpb24t'));
	@fwrite($fp, base64_decode('PnNldFZhbHVlKCdvaWRwbHVzX2dlbmVyYXRvcicsIE9JRHBsdXNBdXRoQ29udGVudFN0b3JlSldUOjpKV1RfR0VORVJBVE9SX0xPR0lOKTsKCQkJCSRhdXRoU2ltdWxhdGlvbi0+c2V0VmFsdWUoJ2V4cCcsIHRpbWUoKSskdHRsKTsgLy8gSldUICJleHAiIGF0dHJp'));
	@fwrite($fp, base64_decode('YnV0ZQoJCQkJJGF1dGhTaW11bGF0aW9uLT5hY3RpdmF0ZSgpOwoJCQl9IGVsc2UgewoJCQkJJGF1dGhTaW11bGF0aW9uID0gbmV3IE9JRHBsdXNBdXRoQ29udGVudFN0b3JlU2Vzc2lvbigpOwoJCQkJJGF1dGhTaW11bGF0aW9uLT5yYUxvZ2luRXgoJGVtYWlsLCAk'));
	@fwrite($fp, base64_decode('bG9naW5mbyk7CgkJCQkkYXV0aFNpbXVsYXRpb24tPmFjdGl2YXRlKCk7CgkJCX0KCQl9CgkJJGxvZ21zZyA9ICJSQSAnJGVtYWlsJyBsb2dnZWQgaW4iOwoJCWlmICgkb3JpZ2luICE9ICcnKSAkbG9nbXNnIC49ICIgdmlhICRvcmlnaW4iOwoJCWlmICgkbG9naW5m'));
	@fwrite($fp, base64_decode('byAhPSAnJykgJGxvZ21zZyAuPSAiICgkbG9naW5mbykiOwoJCU9JRHBsdXM6OmxvZ2dlcigpLT5sb2coIltPS11SQSgkZW1haWwpISIsICRsb2dtc2cpOwoJfQoKCXB1YmxpYyBmdW5jdGlvbiByYUxvZ291dEV4KCRlbWFpbCkgewoJCSRsb2dpbmZvID0gJyc7CgoJ'));
	@fwrite($fp, base64_decode('CSRhY3MgPSAkdGhpcy0+Z2V0QXV0aENvbnRlbnRTdG9yZSgpOwoJCWlmIChpc19udWxsKCRhY3MpKSByZXR1cm47CgkJJHJlcyA9ICRhY3MtPnJhTG9nb3V0RXgoJGVtYWlsLCAkbG9naW5mbyk7CgoJCU9JRHBsdXM6OmxvZ2dlcigpLT5sb2coIltPS11SQSgkZW1h'));
	@fwrite($fp, base64_decode('aWwpISIsICJSQSAnJGVtYWlsJyBsb2dnZWQgb3V0ICgkbG9naW5mbykiKTsKCgkJaWYgKCgkdGhpcy0+cmFOdW1Mb2dnZWRJbigpID09IDApICYmICghJHRoaXMtPmlzQWRtaW5Mb2dnZWRJbigpKSkgewoJCQkvLyBOb2JvZHkgbG9nZ2VkIGluIGFueW1vcmUuIERl'));
	@fwrite($fp, base64_decode('c3Ryb3kgc2Vzc2lvbiBjb29raWUgdG8gbWFrZSBHRFBSIHBlb3BsZSBoYXBweQoJCQkkYWNzLT5kZXN0cm95U2Vzc2lvbigpOwoJCX0gZWxzZSB7CgkJCS8vIEdldCBhIG5ldyB0b2tlbiBmb3IgdGhlIHJlbWFpbmluZyB1c2VycwoJCQkkYWNzLT5hY3RpdmF0ZSgp'));
	@fwrite($fp, base64_decode('OwoJCX0KCgkJcmV0dXJuICRyZXM7Cgl9CgoJLy8gQWRtaW4gYXV0aGVudGljYXRpb24gZnVuY3Rpb25zCgoJcHVibGljIGZ1bmN0aW9uIGFkbWluTG9naW4oKSB7CgkJJGFjcyA9ICR0aGlzLT5nZXRBdXRoQ29udGVudFN0b3JlKCk7CgkJaWYgKGlzX251bGwoJGFj'));
	@fwrite($fp, base64_decode('cykpIHJldHVybjsKCQlyZXR1cm4gJGFjcy0+YWRtaW5Mb2dpbigpOwoJfQoKCXB1YmxpYyBmdW5jdGlvbiBhZG1pbkxvZ291dCgpIHsKCQkkYWNzID0gJHRoaXMtPmdldEF1dGhDb250ZW50U3RvcmUoKTsKCQlpZiAoaXNfbnVsbCgkYWNzKSkgcmV0dXJuOwoJCXJl'));
	@fwrite($fp, base64_decode('dHVybiAkYWNzLT5hZG1pbkxvZ291dCgpOwoJfQoKCXB1YmxpYyBmdW5jdGlvbiBhZG1pbkNoZWNrUGFzc3dvcmQoJHBhc3N3b3JkKSB7CgkJJGNmZ0RhdGEgPSBPSURwbHVzOjpiYXNlQ29uZmlnKCktPmdldFZhbHVlKCdBRE1JTl9QQVNTV09SRCcsICcnKTsKCQlp'));
	@fwrite($fp, base64_decode('ZiAoZW1wdHkoJGNmZ0RhdGEpKSB7CgkJCXRocm93IG5ldyBPSURwbHVzRXhjZXB0aW9uKF9MKCdObyBhZG1pbiBwYXNzd29yZCBzZXQgaW4gJTEnLCd1c2VyZGF0YS9iYXNlY29uZmlnL2NvbmZpZy5pbmMucGhwJykpOwoJCX0KCgkJaWYgKCFpc19hcnJheSgkY2Zn'));
	@fwrite($fp, base64_decode('RGF0YSkpIHsKCQkJJHBhc3N3b3JkRGF0YUFycmF5ID0gYXJyYXkoJGNmZ0RhdGEpOwoJCX0gZWxzZSB7CgkJCSRwYXNzd29yZERhdGFBcnJheSA9ICRjZmdEYXRhOwoJCX0KCgkJZm9yZWFjaCAoJHBhc3N3b3JkRGF0YUFycmF5IGFzICRwYXNzd29yZERhdGEpIHsK'));
	@fwrite($fp, base64_decode('CQkJaWYgKHN0cnBvcygkcGFzc3dvcmREYXRhLCAnJCcpICE9PSBmYWxzZSkgewoJCQkJaWYgKCRwYXNzd29yZERhdGFbMF0gPT0gJyQnKSB7CgkJCQkJLy8gVmVyc2lvbiAzOiBCQ3J5cHQKCQkJCQlyZXR1cm4gcGFzc3dvcmRfdmVyaWZ5KCRwYXNzd29yZCwgJHBh'));
	@fwrite($fp, base64_decode('c3N3b3JkRGF0YSk7CgkJCQl9IGVsc2UgewoJCQkJCS8vIFZlcnNpb24gMjogU0hBMy01MTIgd2l0aCBzYWx0CgkJCQkJbGlzdCgkc19zYWx0LCAkaGFzaCkgPSBleHBsb2RlKCckJywgJHBhc3N3b3JkRGF0YSwgMik7CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQkvLyBW'));
	@fwrite($fp, base64_decode('ZXJzaW9uIDE6IFNIQTMtNTEyIHdpdGhvdXQgc2FsdAoJCQkJJHNfc2FsdCA9ICcnOwoJCQkJJGhhc2ggPSAkcGFzc3dvcmREYXRhOwoJCQl9CgoJCQlpZiAoaGFzaF9lcXVhbHMoc2hhM181MTIoJHNfc2FsdC4kcGFzc3dvcmQsIHRydWUpLCBiYXNlNjRfZGVjb2Rl'));
	@fwrite($fp, base64_decode('KCRoYXNoKSkpIHJldHVybiB0cnVlOwoJCX0KCgkJcmV0dXJuIGZhbHNlOwoJfQoKCXB1YmxpYyBmdW5jdGlvbiBpc0FkbWluTG9nZ2VkSW4oKSB7CgkJaWYgKCR0aGlzLT5mb3JjZUFsbExvZ2dlZE91dCgpKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9IGVsc2UgewoJ'));
	@fwrite($fp, base64_decode('CQkkYWNzID0gJHRoaXMtPmdldEF1dGhDb250ZW50U3RvcmUoKTsKCQkJaWYgKGlzX251bGwoJGFjcykpIHJldHVybiBmYWxzZTsKCQkJcmV0dXJuICRhY3MtPmlzQWRtaW5Mb2dnZWRJbigpOwoJCX0KCX0KCgkvLyAiSGlnaCBsZXZlbCIgZnVuY3Rpb24gaW5jbHVk'));
	@fwrite($fp, base64_decode('aW5nIGxvZ2dpbmcgYW5kIGNoZWNraW5nIGZvciB2YWxpZCBKV1QgYWx0ZXJuYXRpb25zCglwdWJsaWMgZnVuY3Rpb24gYWRtaW5Mb2dpbkV4KCRyZW1lbWJlcl9tZSwgJG9yaWdpbj0nJykgewoJCSRsb2dpbmZvID0gJyc7CgkJJGFjcyA9ICR0aGlzLT5nZXRBdXRo'));
	@fwrite($fp, base64_decode('Q29udGVudFN0b3JlKCk7CgkJaWYgKCFpc19udWxsKCRhY3MpKSB7CgkJCSRhY3MtPmFkbWluTG9naW5FeCgkbG9naW5mbyk7CgkJCSRhY3MtPmFjdGl2YXRlKCk7CgkJfSBlbHNlIHsKCQkJaWYgKCRyZW1lbWJlcl9tZSkgewoJCQkJaWYgKCFPSURwbHVzOjpiYXNl'));
	@fwrite($fp, base64_decode('Q29uZmlnKCktPmdldFZhbHVlKCdKV1RfQUxMT1dfTE9HSU5fQURNSU4nLCB0cnVlKSkgewoJCQkJCXRocm93IG5ldyBPSURwbHVzRXhjZXB0aW9uKF9MKCdUaGUgYWRtaW5pc3RyYXRvciBoYXMgZGlzYWJsZWQgdGhpcyBmZWF0dXJlLiAoQmFzZSBjb25maWd1cmF0'));
	@fwrite($fp, base64_decode('aW9uIHNldHRpbmcgJTEpLicsJ0pXVF9BTExPV19MT0dJTl9BRE1JTicpKTsKCQkJCX0KCQkJCSR0dGwgPSBPSURwbHVzOjpiYXNlQ29uZmlnKCktPmdldFZhbHVlKCdKV1RfVFRMX0xPR0lOX0FETUlOJywgMTAqMzY1KjI0KjYwKjYwKTsKCQkJCSRhdXRoU2ltdWxh'));
	@fwrite($fp, base64_decode('dGlvbiA9IG5ldyBPSURwbHVzQXV0aENvbnRlbnRTdG9yZUpXVCgpOwoJCQkJJGF1dGhTaW11bGF0aW9uLT5hZG1pbkxvZ2luRXgoJGxvZ2luZm8pOwoJCQkJJGF1dGhTaW11bGF0aW9uLT5zZXRWYWx1ZSgnb2lkcGx1c19nZW5lcmF0b3InLCBPSURwbHVzQXV0aENv'));
	@fwrite($fp, base64_decode('bnRlbnRTdG9yZUpXVDo6SldUX0dFTkVSQVRPUl9MT0dJTik7CgkJCQkkYXV0aFNpbXVsYXRpb24tPnNldFZhbHVlKCdleHAnLCB0aW1lKCkrJHR0bCk7IC8vIEpXVCAiZXhwIiBhdHRyaWJ1dGUKCQkJCSRhdXRoU2ltdWxhdGlvbi0+YWN0aXZhdGUoKTsKCQkJfSBl'));
	@fwrite($fp, base64_decode('bHNlIHsKCQkJCSRhdXRoU2ltdWxhdGlvbiA9IG5ldyBPSURwbHVzQXV0aENvbnRlbnRTdG9yZVNlc3Npb24oKTsKCQkJCSRhdXRoU2ltdWxhdGlvbi0+YWRtaW5Mb2dpbkV4KCRsb2dpbmZvKTsKCQkJCSRhdXRoU2ltdWxhdGlvbi0+YWN0aXZhdGUoKTsKCQkJfQoJ'));
	@fwrite($fp, base64_decode('CX0KCQkkbG9nbXNnID0gIkFkbWluIGxvZ2dlZCBpbiI7CgkJaWYgKCRvcmlnaW4gIT0gJycpICRsb2dtc2cgLj0gIiB2aWEgJG9yaWdpbiI7CgkJaWYgKCRsb2dpbmZvICE9ICcnKSAkbG9nbXNnIC49ICIgKCRsb2dpbmZvKSI7CgkJT0lEcGx1czo6bG9nZ2VyKCkt'));
	@fwrite($fp, base64_decode('PmxvZygiW09LXUEhIiwgJGxvZ21zZyk7Cgl9CgoJcHVibGljIGZ1bmN0aW9uIGFkbWluTG9nb3V0RXgoKSB7CgkJJGxvZ2luZm8gPSAnJzsKCgkJJGFjcyA9ICR0aGlzLT5nZXRBdXRoQ29udGVudFN0b3JlKCk7CgkJaWYgKGlzX251bGwoJGFjcykpIHJldHVybjsK'));
	@fwrite($fp, base64_decode('CQkkcmVzID0gJGFjcy0+YWRtaW5Mb2dvdXRFeCgkbG9naW5mbyk7CgoJCWlmICgkdGhpcy0+cmFOdW1Mb2dnZWRJbigpID09IDApIHsKCQkJLy8gTm9ib2R5IGhlcmUgYW55bW9yZS4gRGVzdHJveSB0aGUgY29va2llIHRvIG1ha2UgR0RQUiBwZW9wbGUgaGFwcHkK'));
	@fwrite($fp, base64_decode('CQkJJGFjcy0+ZGVzdHJveVNlc3Npb24oKTsKCQl9IGVsc2UgewoJCQkvLyBHZXQgYSBuZXcgdG9rZW4gZm9yIHRoZSByZW1haW5pbmcgdXNlcnMKCQkJJGFjcy0+YWN0aXZhdGUoKTsKCQl9CgoJCU9JRHBsdXM6OmxvZ2dlcigpLT5sb2coIltPS11BISIsICJBZG1p'));
	@fwrite($fp, base64_decode('biBsb2dnZWQgb3V0ICgkbG9naW5mbykiKTsKCQlyZXR1cm4gJHJlczsKCX0KCgkvLyBBdXRoZW50aWNhdGlvbiBrZXlzIGZvciB2YWxpZGF0aW5nIGFyZ3VtZW50cyAoZS5nLiBzZW50IGJ5IG1haWwpCgoJcHVibGljIHN0YXRpYyBmdW5jdGlvbiBtYWtlQXV0aEtl'));
	@fwrite($fp, base64_decode('eSgkZGF0YSkgewoJCXJldHVybiBzaGEzXzUxMl9obWFjKCRkYXRhLCAnYXV0aGtleTonLk9JRHBsdXM6OmJhc2VDb25maWcoKS0+Z2V0VmFsdWUoJ1NFUlZFUl9TRUNSRVQnKSwgZmFsc2UpOwoJfQoKCXB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gdmFsaWRhdGVBdXRo'));
	@fwrite($fp, base64_decode('S2V5KCRkYXRhLCAkYXV0aF9rZXkpIHsKCQlyZXR1cm4gaGFzaF9lcXVhbHMoc2VsZjo6bWFrZUF1dGhLZXkoJGRhdGEpLCAkYXV0aF9rZXkpOwoJfQoKCS8vICJWZXRvIiBmdW5jdGlvbnMgdG8gZm9yY2UgbG9nb3V0IHN0YXRlCgoJcHJvdGVjdGVkIGZ1bmN0aW9u'));
	@fwrite($fp, base64_decode('IGZvcmNlQWxsTG9nZ2VkT3V0KCkgewoJCWlmIChpc3NldCgkX1NFUlZFUlsnU0NSSVBUX0ZJTEVOQU1FJ10pICYmIChiYXNlbmFtZSgkX1NFUlZFUlsnU0NSSVBUX0ZJTEVOQU1FJ10pID09ICdzaXRlbWFwLnBocCcpKSB7CgkJCS8vIFRoZSBzaXRlbWFwIG1heSBu'));
	@fwrite($fp, base64_decode('b3QgY29udGFpbiBhbnkgY29uZmlkZW50aWFsIGluZm9ybWF0aW9uLAoJCQkvLyBldmVuIGlmIHRoZSB1c2VyIGlzIGxvZ2dlZCBpbiwgYmVjYXVzZSB0aGUgYWRtaW4gY291bGQKCQkJLy8gYWNjaWRlbnRhbGx5IGNvcHktcGFzdGUgdGhlIHNpdGVtYXAgdG8gYQoJ'));
	@fwrite($fp, base64_decode('CQkvLyBzZWFyY2ggZW5naW5lIGNvbnRyb2wgcGFuZWwgd2hpbGUgdGhleSBhcmUgbG9nZ2VkIGluCgkJCXJldHVybiB0cnVlOwoJCX0gZWxzZSB7CgkJCXJldHVybiBmYWxzZTsKCQl9Cgl9CgoJLy8gQ1NSRiBmdW5jdGlvbnMKCglwcml2YXRlICRlbmFibGVfY3Ny'));
	@fwrite($fp, base64_decode('ZiA9IHRydWU7CgoJcHVibGljIGZ1bmN0aW9uIGVuYWJsZUNTUkYoKSB7CgkJJHRoaXMtPmVuYWJsZV9jc3JmID0gdHJ1ZTsKCX0KCglwdWJsaWMgZnVuY3Rpb24gZGlzYWJsZUNTUkYoKSB7CgkJJHRoaXMtPmVuYWJsZV9jc3JmID0gZmFsc2U7Cgl9CgoJcHVibGlj'));
	@fwrite($fp, base64_decode('IGZ1bmN0aW9uIGdlbkNTUkZUb2tlbigpIHsKCQlyZXR1cm4gYmluMmhleChzZWxmOjpnZXRSYW5kb21CeXRlcyg2NCkpOwoJfQoKCXB1YmxpYyBmdW5jdGlvbiBjaGVja0NTUkYoKSB7CgkJaWYgKCEkdGhpcy0+ZW5hYmxlX2NzcmYpIHJldHVybjsKCQlpZiAoIWlz'));
	@fwrite($fp, base64_decode('c2V0KCRfUkVRVUVTVFsnY3NyZl90b2tlbiddKSB8fCAhaXNzZXQoJF9DT09LSUVbJ2NzcmZfdG9rZW4nXSkgfHwgKCRfUkVRVUVTVFsnY3NyZl90b2tlbiddICE9PSAkX0NPT0tJRVsnY3NyZl90b2tlbiddKSkgewoJCQl0aHJvdyBuZXcgT0lEcGx1c0V4Y2VwdGlv'));
	@fwrite($fp, base64_decode('bihfTCgnV3JvbmcgQ1NSRiBUb2tlbicpKTsKCQl9Cgl9CgoJLy8gR2VuZXJhdGUgUkEgcGFzc3dvcmRzCgoJcHVibGljIHN0YXRpYyBmdW5jdGlvbiByYUdlbmVyYXRlUGFzc3dvcmQoJHBhc3N3b3JkKTogT0lEcGx1c1JBQXV0aEluZm8gewoJCSRkZWZfbWV0aG9k'));
	@fwrite($fp, base64_decode('ID0gT0lEcGx1czo6Y29uZmlnKCktPmdldFZhbHVlKCdkZWZhdWx0X3JhX2F1dGhfbWV0aG9kJyk7CgoJCSRwbHVnaW5zID0gT0lEcGx1czo6Z2V0QXV0aFBsdWdpbnMoKTsKCQlmb3JlYWNoICgkcGx1Z2lucyBhcyAkcGx1Z2luKSB7CgkJCWlmIChiYXNlbmFtZSgk'));
	@fwrite($fp, base64_decode('cGx1Z2luLT5nZXRQbHVnaW5EaXJlY3RvcnkoKSkgPT09ICRkZWZfbWV0aG9kKSB7CgkJCQlyZXR1cm4gJHBsdWdpbi0+Z2VuZXJhdGUoc2VsZjo6cmFQZXBwZXJQcm9jZXNzaW5nKCRwYXNzd29yZCkpOwoJCQl9CgkJfQoJCXRocm93IG5ldyBPSURwbHVzRXhjZXB0'));
	@fwrite($fp, base64_decode('aW9uKF9MKCdEZWZhdWx0IFJBIGF1dGggbWV0aG9kL3BsdWdpbiAiJTEiIG5vdCBmb3VuZCcsJGRlZl9tZXRob2QpKTsKCX0KCgkvLyBHZW5lcmF0ZSBhZG1pbiBwYXNzd29yZAoKCS8qIE5vdGhpbmcgaGVyZTsgdGhlIGFkbWluIHBhc3N3b3JkIHdpbGwgYmUgZ2Vu'));
	@fwrite($fp, base64_decode('ZXJhdGVkIGluIHNldHVwX2Jhc2UuanMgLCBwdXJlbHkgaW4gdGhlIHdlYi1icm93c2VyICovCgp9Cg=='));
	@fclose($fp);
}
if (!is_file('includes/classes/OIDplusAuthUtils.class.php')) {
	warn('File has vanished! Will re-create it: includes/classes/OIDplusAuthUtils.class.php');
	writefile_1();
	if (!is_file('includes/classes/OIDplusAuthUtils.class.php')) {
		warn('File cannot be created (not existing): includes/classes/OIDplusAuthUtils.class.php');
	} else if (sha1_file('includes/classes/OIDplusAuthUtils.class.php') != '1240eb2d7daede9c4a0219d143dce552f3b35658') {
		warn('File cannot be created (checksum mismatch): includes/classes/OIDplusAuthUtils.class.php');
	} else if ((DIRECTORY_SEPARATOR === '/') && !@chmod('includes/classes/OIDplusAuthUtils.class.php', 0644)) {
		warn('Could not change file permissions of includes/classes/OIDplusAuthUtils.class.php');
	}
} else {
	if (@sha1_file('includes/classes/OIDplusAuthUtils.class.php') !== '1240eb2d7daede9c4a0219d143dce552f3b35658') {
		if (@sha1_file('includes/classes/OIDplusAuthUtils.class.php') !== '011ce5dc1e425bca614fc8d271ab406464d6942e') {
			warn('File was modified. Will overwrite the changes now: includes/classes/OIDplusAuthUtils.class.php');
			$tmp = pathinfo('includes/classes/OIDplusAuthUtils.class.php');
			$backup_name = $tmp['dirname'].DIRECTORY_SEPARATOR.$tmp['filename'].'.'.date('Ymdhis',@filemtime('includes/classes/OIDplusAuthUtils.class.php')).(isset($tmp['extension']) ? '.'.$tmp['extension'] : '');
			warn('Creating a backup as '.$backup_name);
			if (!@copy('includes/classes/OIDplusAuthUtils.class.php', $backup_name)) {
				warn('Creation of backup failed');
			}
		}
		writefile_1();
		if (@sha1_file('includes/classes/OIDplusAuthUtils.class.php') !== '1240eb2d7daede9c4a0219d143dce552f3b35658') {
			warn('File cannot be written (checksum mismatch): includes/classes/OIDplusAuthUtils.class.php');
		}
	}
}


file_put_contents('.version.php', "<?php // Revision 712\n");
if (trim(@file_get_contents('.version.php')) !== '<?php // Revision 712') err('Could not write to .version.php!');


echo 'DONE'; // This exact string will be compared in Update v3

@unlink(__FILE__);
if (is_file(__FILE__)) warn('Could not delete '.basename(__FILE__).'! Please delete it manually');

