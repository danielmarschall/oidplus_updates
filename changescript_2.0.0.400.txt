<?php /* <ViaThinkSoftSignature>
HwdUn/Zy+mjzb88TY6p79dH8XZwNb+L6Eb/4ti73U2zGHYrFlcn67EiByt4WsmrYV
CfW5tjJoXqsY5nzHe/+Q9TAl5OEu5CFd0aZ9uukWVTE/cJSxgW2N9nJ9rp5CaOpe7
5TfzNVq9HFjG5sIYhslUBeBMnPjam5VT1jpg651O3OabkwRJ4/JVjZPukgHCSfrpH
ro+EZfC4FmVGVYnKp9bZDwAtLD7Fn/auaicMl5BislJp3XORZrUscREIBlvpM27H9
etW9K3cl0EqjOfkogkrp/n+B9lrxzBsuUEX2CmBdGXAxe7/9YDH+SWLNjjBTa4UQk
ec5WNit7tLK3cZIjX4+NHwXsjGL2Ompj1hwECKlrIruCEAzxENrYArlw3+3xE4H5X
H4UC52qLn4FBkk3ZCyRNVkNxFJlxnlBXJqect2Pxgb+wax1SXZx1KXi7T7Md9upZf
dWeFQ53NTc+yalTFhauPAyvJ+p+1avFe3e6cRAzsi/giyJor7aTsXxQEnsARsez3W
n2eVrM6XR0EyFS+slGNEFI49W/5sQsoFENz2ANH1VaQI4O/z/OTkFwMoNp0ZITRwt
SyPSwrhNFfbFlU/WPDks/uhuR2hn2K3O+ykojO0nDSYiminydvw7lkkZ7Gzvr5Uk+
VYuKsKGaAJOyQtYMIBRtz/PjR3YoQPwmOLAWkLxWcaCmPa9B+/a2VDbybbpnC+LQp
3VM1r23Exf9ZEIkNFlMvsOMHl5xjAZN67r6hI/oyHcKMtgrJ4JoNN+UyMtpQmtTsX
j405ttDaDWezl+MH4rxmsqqKOOPJoEuUoos4iYCXZJQlqQkYHvG53F9y4EuGPBcHX
Q++nFdKAWyYGmLR3GfZDBIFMv+mtqSQ16w5mUpHLupGrqr2ElU0M0KOoQBo6HFka2
L2wUElq61w0zDlgdxDGy4x0q6XH9TYpFp9QvHgtrCabF/D720sPGmDmZtUndmJYWV
mf+ybsMHXmMM42gfCwVX62ReMO0zEBW90cXh33k7Mwk3L4P+xe6Z3oZUGiuQIom0v
pEm6vEPinPn6hQfs/XJlCdIatIV58B5z6+sDaPnHEecU8FhZS95Tv7bEYkKJXQd54
95c2BINjeVx9oSZ/1qekhSc4uwtm5EXcL2CPbhSr3sf7emZnEnD+ttUXRXuwtmkOf
RIOfi8PF3SCjPlf/BUXA/9Q1+khEycFwRHaE1vhSTNyCJPYeiBx154AIU5OGvY7Sf
O4PYO5+MsOaEDMwBSWaYvbRb5+QqozcevNHUROu0grvI4DIftsfax/mrDkDC8gW2m
2HDAYmNAb+ETBwM4IKn0Ax6l2fZSc7JgCu+UdskuM/a4UNoG2HWy77pqAmewCCpmm
A==
</ViaThinkSoftSignature> */ ?>
<?php

/*
 * OIDplus 2.0
 * Copyright 2019 - 2023 Daniel Marschall, ViaThinkSoft
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

function info($str) { echo "INFO: $str\n"; }
function warn($str) { echo "WARNING: $str\n"; }
function err($str) { die("FATAL ERROR: $str\n"); }

@set_time_limit(0);

@header('Content-Type: text/plain');

chdir(__DIR__);
if (trim(@file_get_contents('oidplus_version.txt')) !== 'Revision 399') {
	err('This update can only be applied to OIDplus version 2.0.0.399!');
}

if (version_compare(PHP_VERSION, '7.0.0') < 0) {
	err('You need PHP Version 7.0 to update to this version');
}

// Files different: includes/classes/OIDplusMailUtils.class.php
function writefile_1() {
	@$fp = fopen('includes/classes/OIDplusMailUtils.class.php', 'w');
	@fwrite($fp, base64_decode('PD9waHAKCi8qCiAqIE9JRHBsdXMgMi4wCiAqIENvcHlyaWdodCAyMDE5IERhbmllbCBNYXJzY2hhbGwsIFZpYVRoaW5rU29mdAogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91'));
	@fwrite($fp, base64_decode('IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNF'));
	@fwrite($fp, base64_decode('TlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMs'));
	@fwrite($fp, base64_decode('CiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAq'));
	@fwrite($fp, base64_decode('IGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KCmNsYXNzIE9JRHBsdXNNYWlsVXRpbHMgewoKCXB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gdmFsaWRNYWlsQWRkcmVzcygkZW1haWwpIHsKCQlyZXR1cm4gIWVtcHR5KGZpbHRlcl92YXIoJGVtYWlsLCBG'));
	@fwrite($fp, base64_decode('SUxURVJfVkFMSURBVEVfRU1BSUwpKTsKCX0KCglwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIHNlY3VyZUVtYWlsQWRkcmVzcygkZW1haWwsICRsaW5rdGV4dCwgJGxldmVsPTEpIHsKCgkJLy8gc2VlIGh0dHA6Ly93d3cuc3BhbXNwYW4uZGUvCgoJCS8qIExldmVsIDEg'));
	@fwrite($fp, base64_decode('Ki8KCQkvKgoJCTxzcGFuIGNsYXNzPSJzcGFtc3BhbiI+CgkJPHNwYW4gY2xhc3M9InUiPnVzZXI8L3NwYW4+CgkJQAoJCTxzcGFuIGNsYXNzPSJkIj5iZWlzcGllbC5kZTwvc3Bhbj4KCQkoPHNwYW4gY2xhc3M9InQiPlNwYW0gSGFzc2VyPC9zcGFuPikKCQk8L3Nw'));
	@fwrite($fp, base64_decode('YW4+CgkJKi8KCgkJaWYgKCRsZXZlbCA9PSAxKSB7CgkJCUBsaXN0KCR1c2VyLCAkZG9tYWluKSA9IGV4cGxvZGUoJ0AnLCAkZW1haWwpOwoJCQlpZiAoKCRsaW5rdGV4dCA9PSAkZW1haWwpIHx8IGVtcHR5KCRsaW5rdGV4dCkpIHsKCQkJCXJldHVybiAnPHNwYW4g'));
	@fwrite($fp, base64_decode('Y2xhc3M9InNwYW1zcGFuIj48c3BhbiBjbGFzcz0idSI+Jy5odG1sZW50aXRpZXMoJHVzZXIpLic8L3NwYW4+JiM2NDs8c3BhbiBjbGFzcz0iZCI+Jy5odG1sZW50aXRpZXMoJGRvbWFpbikuJzwvc3Bhbj48L3NwYW4+JzsKCQkJfSBlbHNlIHsKCQkJCXJldHVybiAn'));
	@fwrite($fp, base64_decode('PHNwYW4gY2xhc3M9InNwYW1zcGFuIj48c3BhbiBjbGFzcz0idSI+Jy5odG1sZW50aXRpZXMoJHVzZXIpLic8L3NwYW4+JiM2NDs8c3BhbiBjbGFzcz0iZCI+Jy5odG1sZW50aXRpZXMoJGRvbWFpbikuJzwvc3Bhbj4oPHNwYW4gY2xhc3M9InQiPicuaHRtbGVudGl0'));
	@fwrite($fp, base64_decode('aWVzKCRsaW5rdGV4dCkuJzwvc3Bhbj4pPC9zcGFuPic7CgkJCX0KCQl9CgoJCS8qIExldmVsIDIgKi8KCQkvKgoJCTxzcGFuIGNsYXNzPSJzcGFtc3BhbiI+CgkJCTxzcGFuIGNsYXNzPSJ1Ij51c2VyPC9zcGFuPgoJCQk8aW1nIGFsdD0iYXQiIHdpZHRoPSIxMCIg'));
	@fwrite($fp, base64_decode('c3JjPSJALnBuZyI+CgkJCTxzcGFuIGNsYXNzPSJkIj5iZWlzcGllbC5kZTwvc3Bhbj4KCQk8L3NwYW4+CgkJKi8KCgkJaWYgKCRsZXZlbCA9PSAyKSB7CgkJCWxpc3QoJHVzZXIsICRkb21haW4pID0gZXhwbG9kZSgnQCcsICRlbWFpbCk7CgkJCXJldHVybiAnPHNw'));
	@fwrite($fp, base64_decode('YW4gY2xhc3M9InNwYW1zcGFuIj48c3BhbiBjbGFzcz0idSI+Jy5odG1sZW50aXRpZXMoJHVzZXIpLic8L3NwYW4+PGltZyBhbHQ9ImF0IiB3aWR0aD0iMTAiIHNyYz0iQC5wbmciPjxzcGFuIGNsYXNzPSJkIj4nLmh0bWxlbnRpdGllcygkZG9tYWluKS4nPC9zcGFu'));
	@fwrite($fp, base64_decode('Pjwvc3Bhbj4nOwoJCX0KCgkJLyogTGV2ZWwgMyAqLwoJCS8qCgkJPHNwYW4gY2xhc3M9InNwYW1zcGFuIj4KCQkJPHNwYW4gY2xhc3M9InUiPnVzZXI8L3NwYW4+CgkJCVthdF0KCQkJPHNwYW4gY2xhc3M9ImQiPmJlaXNwaWVsIFtkb3RdIGRlPC9zcGFuPgoJCTwv'));
	@fwrite($fp, base64_decode('c3Bhbj4KCQkqLwoKCQlpZiAoJGxldmVsID09IDMpIHsKCQkJbGlzdCgkdXNlciwgJGRvbWFpbikgPSBleHBsb2RlKCdAJywgJGVtYWlsKTsKCQkJJGRvbWFpbiA9IHN0cl9yZXBsYWNlKCcuJywgJyAnLl9MKCdbZG90XScpLicgJywgJGRvbWFpbik7CgkJCXJldHVy'));
	@fwrite($fp, base64_decode('biAnPHNwYW4gY2xhc3M9InNwYW1zcGFuIj48c3BhbiBjbGFzcz0idSI+Jy5odG1sZW50aXRpZXMoJHVzZXIpLic8L3NwYW4+ICcuX0woJ1thdF0nKS4nIDxzcGFuIGNsYXNzPSJkIj4nLmh0bWxlbnRpdGllcygkZG9tYWluKS4nPC9zcGFuPjwvc3Bhbj4nOwoJCX0K'));
	@fwrite($fp, base64_decode('CgkJcmV0dXJuIG51bGw7CgoKCQkvLyAtLS0gT2xkIGNvZGUgLS0tCgoJCS8qCgkJLy8gQXR0ZW50aW9uOiBkb2N1bWVudC53cml0ZSgpIEphdmFTY3JpcHQgd2lsbCBkYW1hZ2UgdGhlIGJyb3dzZXIgY2FjaGUsIHdoaWNoIGxlYWRzIHRvIGJ1Z3MgaWYgeW91IG5h'));
	@fwrite($fp, base64_decode('dmlnYXRlIGJhY2smZm9ydGggd2l0aCB0aGUgYnJvd3NlciBuYXZpZ2F0aW9uCgoJCSRjcnlwdF9saW5rdGV4dCA9IHRydWU7CgoJCS8vIE5vIG5ldyBsaW5lcyB0byBhdm9pZCBhIEphdmFTY3JpcHQgZXJyb3IhCgkJJGxpbmt0ZXh0ID0gc3RyX3JlcGxhY2UoIlxy'));
	@fwrite($fp, base64_decode('IiwgJyAnLCAkbGlua3RleHQpOwoJCSRsaW5rdGV4dCA9IHN0cl9yZXBsYWNlKCJcbiIsICcgJywgJGxpbmt0ZXh0KTsKCgkJaWYgKCFmdW5jdGlvbl9leGlzdHMoJ2FsYXNfanNfY3J5cHQnKSkKCQl7CgkJCWZ1bmN0aW9uIGFsYXNfanNfY3J5cHQoJHRleHQpCgkJ'));
	@fwrite($fp, base64_decode('CXsKCQkJCSR0bXAgPSAnJzsKCQkJCWZvciAoJGk9MDsgJGk8c3RybGVuKCR0ZXh0KTsgJGkrKykKCQkJCXsKCQkJCQkkdG1wIC49ICdkb2N1bWVudC53cml0ZSgiJiMnLm9yZChzdWJzdHIoJHRleHQsICRpLCAxKSkuJzsiKTsnOwoJCQkJfQoJCQkJcmV0dXJuICR0'));
	@fwrite($fp, base64_decode('bXA7CgkJCX0KCQl9CgoJCWlmICghZnVuY3Rpb25fZXhpc3RzKCdhbGFzX2pzX3dyaXRlJykpCgkJewoJCQlmdW5jdGlvbiBhbGFzX2pzX3dyaXRlKCR0ZXh0KQoJCQl7CgkJCQkkdGV4dCA9IHN0cl9yZXBsYWNlKCdcXCcsICdcXFxcJywgJHRleHQpOwoJCQkJJHRl'));
	@fwrite($fp, base64_decode('eHQgPSBzdHJfcmVwbGFjZSgnIicsICdcIicsICR0ZXh0KTsKCQkJCSR0ZXh0ID0gc3RyX3JlcGxhY2UoJy8nLCAnXC8nLCAkdGV4dCk7IC8vIFczQyBWYWxpZGF0aW9uIDwvYT4gLT4gPFwvYT4KCQkJCXJldHVybiAnZG9jdW1lbnQud3JpdGUoIicuJHRleHQuJyIp'));
	@fwrite($fp, base64_decode('Oyc7CgkJCX0KCQl9CgoJCSRhdXMgPSAnJzsKCQlpZiAoJGVtYWlsICE9ICcnKQoJCXsKCQkJJGF1cyAuPSAnPHNjcmlwdD48IS0tJy4iXG4iOyAvLyB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiIGlzIG5vdCBuZWNlc3NhcnkgaW4gSFRNTDUKCQkJJGF1cyAuPSBhbGFz'));
	@fwrite($fp, base64_decode('X2pzX3dyaXRlKCc8YSBocmVmPSInKTsKCQkJJGF1cyAuPSBhbGFzX2pzX2NyeXB0KCdtYWlsdG86Jy4kZW1haWwpOwoJCQkkYXVzIC49IGFsYXNfanNfd3JpdGUoJyI+Jyk7CgkJCSRhdXMgLj0gJGNyeXB0X2xpbmt0ZXh0ID8gYWxhc19qc19jcnlwdCgkbGlua3Rl'));
	@fwrite($fp, base64_decode('eHQpIDogYWxhc19qc193cml0ZSgkbGlua3RleHQpOwoJCQkkYXVzIC49IGFsYXNfanNfd3JpdGUoJzwvYT4nKS4nLy8gLS0+PC9zY3JpcHQ+JzsKCQl9CgoJCWlmICgkY3J5cHRfbGlua3RleHQpICRsaW5rdGV4dCA9IHN0cl9yZXBsYWNlKCdAJywgJyYnLCAkbGlu'));
	@fwrite($fp, base64_decode('a3RleHQpOwoJCSRlbWFpbCA9IHN0cl9yZXBsYWNlKCdAJywgJyYnLCAkZW1haWwpOwoJCXJldHVybiAkYXVzLic8bm9zY3JpcHQ+Jy5odG1sZW50aXRpZXMoJGxpbmt0ZXh0KS4nICgnLmh0bWxlbnRpdGllcygkZW1haWwpLicpPC9ub3NjcmlwdD4nOwoKCQkqLwoJ'));
	@fwrite($fp, base64_decode('fQoKCXB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gc2VuZE1haWwoJHRvLCAkdGl0bGUsICRtc2csICRjYz0nJywgJGJjYz0nJykgewoJCSRoID0gbmV3IFNlY3VyZU1haWxlcigpOwoKCQkkaC0+YWRkSGVhZGVyKCdGcm9tJywgT0lEcGx1czo6Y29uZmlnKCktPmdldFZh'));
	@fwrite($fp, base64_decode('bHVlKCdhZG1pbl9lbWFpbCcpKTsKCgkJaWYgKCFlbXB0eSgkY2MpKSAkaC0+YWRkSGVhZGVyKCdDYycsICAkY2MpOwoJCWlmICghZW1wdHkoJGJjYykpICRoLT5hZGRIZWFkZXIoJ0JjYycsICAkYmNjKTsKCgkJJGgtPmFkZEhlYWRlcignWC1NYWlsZXInLCAnUEhQ'));
	@fwrite($fp, base64_decode('LycucGhwdmVyc2lvbigpKTsKCQlpZiAoaXNzZXQoJF9TRVJWRVJbJ1JFTU9URV9BRERSJ10pKSAkaC0+YWRkSGVhZGVyKCdYLVJlbW90ZUFkZHInLCAkX1NFUlZFUlsnUkVNT1RFX0FERFInXSk7CgkJJGgtPmFkZEhlYWRlcignTUlNRS1WZXJzaW9uJywgJzEuMCcp'));
	@fwrite($fp, base64_decode('OwoJCSRoLT5hZGRIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICd0ZXh0L3BsYWluOyBjaGFyc2V0PUlTTy04ODU5LTEnKTsKCgkJJHNlbnQgPSAkaC0+c2VuZE1haWwoJHRvLCAkdGl0bGUsICRtc2cpOwoJCWlmICghJHNlbnQpIHsKCQkJdGhyb3cgbmV3IE9JRHBsdXNN'));
	@fwrite($fp, base64_decode('YWlsRXhjZXB0aW9uKF9MKCdTZW5kaW5nIG1haWwgZmFpbGVkJykpOwoJCX0KCX0KCn0='));
	@fclose($fp);
}
if (!is_file('includes/classes/OIDplusMailUtils.class.php')) {
	warn('File has vanished! Will re-create it: includes/classes/OIDplusMailUtils.class.php');
	writefile_1();
	if (!is_file('includes/classes/OIDplusMailUtils.class.php')) {
		warn('File cannot be created (not existing): includes/classes/OIDplusMailUtils.class.php');
	} else if (sha1_file('includes/classes/OIDplusMailUtils.class.php') != '08934c67ed6c179669a1ac051512a619e42fb239') {
		warn('File cannot be created (checksum mismatch): includes/classes/OIDplusMailUtils.class.php');
	} else if ((DIRECTORY_SEPARATOR === '/') && !@chmod('includes/classes/OIDplusMailUtils.class.php', 0644)) {
		warn('Could not change file permissions of includes/classes/OIDplusMailUtils.class.php');
	}
} else {
	if (@sha1_file('includes/classes/OIDplusMailUtils.class.php') !== '08934c67ed6c179669a1ac051512a619e42fb239') {
		if (@sha1_file('includes/classes/OIDplusMailUtils.class.php') !== '2c91e034ca29c1c0690f890d18e6b668dae55dd3') {
			warn('File was modified. Will overwrite the changes now: includes/classes/OIDplusMailUtils.class.php');
			$tmp = pathinfo('includes/classes/OIDplusMailUtils.class.php');
			$backup_name = $tmp['dirname'].DIRECTORY_SEPARATOR.$tmp['filename'].'.'.date('Ymdhis',@filemtime('includes/classes/OIDplusMailUtils.class.php')).(isset($tmp['extension']) ? '.'.$tmp['extension'] : '');
			warn('Creating a backup as '.$backup_name);
			if (!@copy('includes/classes/OIDplusMailUtils.class.php', $backup_name)) {
				warn('Creation of backup failed');
			}
		}
		writefile_1();
		if (@sha1_file('includes/classes/OIDplusMailUtils.class.php') !== '08934c67ed6c179669a1ac051512a619e42fb239') {
			warn('File cannot be written (checksum mismatch): includes/classes/OIDplusMailUtils.class.php');
		}
	}
}

// Files different: includes/classes/OIDplusRA.class.php
function writefile_2() {
	@$fp = fopen('includes/classes/OIDplusRA.class.php', 'w');
	@fwrite($fp, base64_decode('PD9waHAKCi8qCiAqIE9JRHBsdXMgMi4wCiAqIENvcHlyaWdodCAyMDE5IERhbmllbCBNYXJzY2hhbGwsIFZpYVRoaW5rU29mdAogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91'));
	@fwrite($fp, base64_decode('IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNF'));
	@fwrite($fp, base64_decode('TlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMs'));
	@fwrite($fp, base64_decode('CiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAq'));
	@fwrite($fp, base64_decode('IGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KCmNsYXNzIE9JRHBsdXNSQSB7Cglwcml2YXRlICRlbWFpbCA9IG51bGw7CgoJcHVibGljIGZ1bmN0aW9uIF9fY29uc3RydWN0KCRlbWFpbCkgewoJCSR0aGlzLT5lbWFpbCA9ICRlbWFpbDsKCX0KCglw'));
	@fwrite($fp, base64_decode('dWJsaWMgZnVuY3Rpb24gcmFFbWFpbCgpIHsKCQlyZXR1cm4gJHRoaXMtPmVtYWlsOwoJfQoKCXB1YmxpYyBmdW5jdGlvbiBleGlzdGluZygpIHsKCQkkcmVzID0gT0lEcGx1czo6ZGIoKS0+cXVlcnkoInNlbGVjdCBlbWFpbCBmcm9tICMjI3JhIHdoZXJlIGVtYWls'));
	@fwrite($fp, base64_decode('ID0gPyIsIGFycmF5KCR0aGlzLT5lbWFpbCkpOwoJCXJldHVybiAoJHJlcy0+bnVtX3Jvd3MoKSA+IDApOwoJfQoKCXB1YmxpYyBmdW5jdGlvbiByYU5hbWUoKSB7CgkJJHJlcyA9IE9JRHBsdXM6OmRiKCktPnF1ZXJ5KCJzZWxlY3QgcmFfbmFtZSBmcm9tICMjI3Jh'));
	@fwrite($fp, base64_decode('IHdoZXJlIGVtYWlsID0gPyIsIGFycmF5KCR0aGlzLT5lbWFpbCkpOwoJCWlmICgkcmVzLT5udW1fcm93cygpID09IDApIHJldHVybiBfTCgnKFJBIG5vdCBpbiBkYXRhYmFzZSknKTsKCQkkcm93ID0gJHJlcy0+ZmV0Y2hfYXJyYXkoKTsKCQlyZXR1cm4gJHJvd1sn'));
	@fwrite($fp, base64_decode('cmFfbmFtZSddOwoJfQoKCXB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZ2V0QWxsUkFzKCkgewoJCSRvdXQgPSBhcnJheSgpOwoJCSRyZXMgPSBPSURwbHVzOjpkYigpLT5xdWVyeSgic2VsZWN0IGVtYWlsIGZyb20gIyMjcmEiKTsKCQl3aGlsZSAoJHJvdyA9ICRyZXMt'));
	@fwrite($fp, base64_decode('PmZldGNoX2FycmF5KCkpIHsKCQkJJG91dFtdID0gbmV3IE9JRHBsdXNSQSgkcm93WydlbWFpbCddKTsKCQl9CgkJcmV0dXJuICRvdXQ7Cgl9CgoJcHVibGljIGZ1bmN0aW9uIGNoYW5nZV9wYXNzd29yZCgkbmV3X3Bhc3N3b3JkKSB7CgkJJHNfc2FsdCA9IHVuaXFp'));
	@fwrite($fp, base64_decode('ZChtdF9yYW5kKCksIHRydWUpOwoJCSRjYWxjX2F1dGhrZXkgPSAnQTIjJy5iYXNlNjRfZW5jb2RlKHNoYTNfNTEyKCRzX3NhbHQuJG5ld19wYXNzd29yZCwgdHJ1ZSkpOwoJCU9JRHBsdXM6OmRiKCktPnF1ZXJ5KCJ1cGRhdGUgIyMjcmEgc2V0IHNhbHQ9PywgYXV0'));
	@fwrite($fp, base64_decode('aGtleT0/IHdoZXJlIGVtYWlsID0gPyIsIGFycmF5KCRzX3NhbHQsICRjYWxjX2F1dGhrZXksICR0aGlzLT5lbWFpbCkpOwoJfQoKCXB1YmxpYyBmdW5jdGlvbiBjaGFuZ2VfZW1haWwoJG5ld19lbWFpbCkgewoJCU9JRHBsdXM6OmRiKCktPnF1ZXJ5KCJ1cGRhdGUg'));
	@fwrite($fp, base64_decode('IyMjcmEgc2V0IGVtYWlsID0gPyB3aGVyZSBlbWFpbCA9ID8iLCBhcnJheSgkbmV3X2VtYWlsLCAkdGhpcy0+ZW1haWwpKTsKCX0KCglwdWJsaWMgZnVuY3Rpb24gcmVnaXN0ZXJfcmEoJG5ld19wYXNzd29yZCkgewoJCSRzX3NhbHQgPSB1bmlxaWQobXRfcmFuZCgp'));
	@fwrite($fp, base64_decode('LCB0cnVlKTsKCQkkY2FsY19hdXRoa2V5ID0gJ0EyIycuYmFzZTY0X2VuY29kZShzaGEzXzUxMigkc19zYWx0LiRuZXdfcGFzc3dvcmQsIHRydWUpKTsKCQlPSURwbHVzOjpkYigpLT5xdWVyeSgiaW5zZXJ0IGludG8gIyMjcmEgKHNhbHQsIGF1dGhrZXksIGVtYWls'));
	@fwrite($fp, base64_decode('LCByZWdpc3RlcmVkLCByYV9uYW1lLCBwZXJzb25hbF9uYW1lLCBvcmdhbml6YXRpb24sIG9mZmljZSwgc3RyZWV0LCB6aXBfdG93biwgY291bnRyeSwgcGhvbmUsIG1vYmlsZSwgZmF4KSB2YWx1ZXMgKD8sID8sID8sICIuT0lEcGx1czo6ZGIoKS0+c3FsRGF0ZSgp'));
	@fwrite($fp, base64_decode('LiIsID8sID8sID8sID8sID8sID8sID8sID8sID8sID8pIiwgYXJyYXkoJHNfc2FsdCwgJGNhbGNfYXV0aGtleSwgJHRoaXMtPmVtYWlsLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIikpOwoJfQoKCXB1YmxpYyBmdW5jdGlvbiBjaGVja1Bh'));
	@fwrite($fp, base64_decode('c3N3b3JkKCRwYXNzd29yZCkgewoJCSRyYV9yZXMgPSBPSURwbHVzOjpkYigpLT5xdWVyeSgic2VsZWN0IGF1dGhrZXksIHNhbHQgZnJvbSAjIyNyYSB3aGVyZSBlbWFpbCA9ID8iLCBhcnJheSgkdGhpcy0+ZW1haWwpKTsKCQlpZiAoJHJhX3Jlcy0+bnVtX3Jvd3Mo'));
	@fwrite($fp, base64_decode('KSA9PSAwKSByZXR1cm4gZmFsc2U7IC8vIFVzZXIgbm90IGZvdW5kCgkJJHJhX3JvdyA9ICRyYV9yZXMtPmZldGNoX2FycmF5KCk7CgoJCSRwbHVnaW5zID0gT0lEcGx1czo6Z2V0QXV0aFBsdWdpbnMoKTsKCQlpZiAoY291bnQoJHBsdWdpbnMpID09IDApIHsKCQkJ'));
	@fwrite($fp, base64_decode('dGhyb3cgbmV3IE9JRHBsdXNFeGNlcHRpb24oX0woJ05vIFJBIGF1dGhlbnRpY2F0aW9uIHBsdWdpbnMgZm91bmQnKSk7CgkJfQoJCWZvcmVhY2ggKCRwbHVnaW5zIGFzICRwbHVnaW4pIHsKCQkJaWYgKCRwbHVnaW4tPnZlcmlmeSgkcmFfcm93WydhdXRoa2V5J10s'));
	@fwrite($fp, base64_decode('ICRyYV9yb3dbJ3NhbHQnXSwgJHBhc3N3b3JkKSkgcmV0dXJuIHRydWU7CgkJfQoKCQlyZXR1cm4gZmFsc2U7Cgl9CgoJcHVibGljIGZ1bmN0aW9uIGRlbGV0ZSgpIHsKCQlPSURwbHVzOjpkYigpLT5xdWVyeSgiZGVsZXRlIGZyb20gIyMjcmEgd2hlcmUgZW1haWwg'));
	@fwrite($fp, base64_decode('PSA/IiwgYXJyYXkoJHRoaXMtPmVtYWlsKSk7Cgl9CgoJcHVibGljIGZ1bmN0aW9uIHNldFJhTmFtZSgkcmFfbmFtZSkgewoJCU9JRHBsdXM6OmRiKCktPnF1ZXJ5KCJ1cGRhdGUgIyMjcmEgc2V0IHJhX25hbWUgPSA/IHdoZXJlIGVtYWlsID0gPyIsIGFycmF5KCRy'));
	@fwrite($fp, base64_decode('YV9uYW1lLCAkdGhpcy0+ZW1haWwpKTsKCX0KfQ=='));
	@fclose($fp);
}
if (!is_file('includes/classes/OIDplusRA.class.php')) {
	warn('File has vanished! Will re-create it: includes/classes/OIDplusRA.class.php');
	writefile_2();
	if (!is_file('includes/classes/OIDplusRA.class.php')) {
		warn('File cannot be created (not existing): includes/classes/OIDplusRA.class.php');
	} else if (sha1_file('includes/classes/OIDplusRA.class.php') != '050af9ebdc3fdb75830c41e31fa6c27dfbf839d7') {
		warn('File cannot be created (checksum mismatch): includes/classes/OIDplusRA.class.php');
	} else if ((DIRECTORY_SEPARATOR === '/') && !@chmod('includes/classes/OIDplusRA.class.php', 0644)) {
		warn('Could not change file permissions of includes/classes/OIDplusRA.class.php');
	}
} else {
	if (@sha1_file('includes/classes/OIDplusRA.class.php') !== '050af9ebdc3fdb75830c41e31fa6c27dfbf839d7') {
		if (@sha1_file('includes/classes/OIDplusRA.class.php') !== '0afd269a2a5aae57caf69310b71e6777994d78c4') {
			warn('File was modified. Will overwrite the changes now: includes/classes/OIDplusRA.class.php');
			$tmp = pathinfo('includes/classes/OIDplusRA.class.php');
			$backup_name = $tmp['dirname'].DIRECTORY_SEPARATOR.$tmp['filename'].'.'.date('Ymdhis',@filemtime('includes/classes/OIDplusRA.class.php')).(isset($tmp['extension']) ? '.'.$tmp['extension'] : '');
			warn('Creating a backup as '.$backup_name);
			if (!@copy('includes/classes/OIDplusRA.class.php', $backup_name)) {
				warn('Creation of backup failed');
			}
		}
		writefile_2();
		if (@sha1_file('includes/classes/OIDplusRA.class.php') !== '050af9ebdc3fdb75830c41e31fa6c27dfbf839d7') {
			warn('File cannot be written (checksum mismatch): includes/classes/OIDplusRA.class.php');
		}
	}
}

// Files different: includes/classes/SecureMailer.class.php
function writefile_3() {
	@$fp = fopen('includes/classes/SecureMailer.class.php', 'w');
	@fwrite($fp, base64_decode('PD9waHANCg0KLyoNCiAqIFNlY3VyZSBNYWlsZXIgUEhQIENsYXNzDQogKiBDb3B5cmlnaHQgMjAwOS0yMDEzIERhbmllbCBNYXJzY2hhbGwsIFZpYVRoaW5rU29mdA0KICogUUJfU0VDVVJFX01BSUxfUEFSQU0gKEMpIEVyaWNoIEthY2hlbA0KICogVmVyc2lvbiAy'));
	@fwrite($fp, base64_decode('MDEzLTA0LTE0DQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2Uu'));
	@fwrite($fp, base64_decode('DQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVl'));
	@fwrite($fp, base64_decode('ZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo'));
	@fwrite($fp, base64_decode('ZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCg0KLy8gVE9ETzogZ2V0'));
	@fwrite($fp, base64_decode('SGVhZGVycygpIGFscyBzaW5nbGUgc3RyaW5nICwgYXR0YWNobWVudHMgLCByZW1vdmUgaGVhZGVycyBldGMsIGhlYWRlcnMgYWxzIGFycmF5IGluL291dCwgQnJhdWNodCBtYW4gYXVjaCBlaW4gYWRkUmF3SGVhZGVyKCk/DQoNCmNsYXNzIFNlY3VyZU1haWxlciB7'));
	@fwrite($fp, base64_decode('DQoJcHJpdmF0ZSAkaGVhZGVycyA9ICcnOw0KDQoJLy8gVE9ETzogc29sbHRlIGVoZXIgcHJpdmF0ZSBzZWluLCBnZWh0IGFiZXIgbmV0DQoJY29uc3QgZW5kbCA9ICJcbiI7IC8vIEdNWCB3aWxsIGtlaW4gQ1JMRiEgd3RmPyEgKFVudGVyIFBvc3RmaXggaW4gTGlu'));
	@fwrite($fp, base64_decode('dXgpDQoNCglwcml2YXRlIGZ1bmN0aW9uIFFCX1NFQ1VSRV9NQUlMX1BBUkFNKCRwYXJhbV8gPSAnJywgJGxldmVsXyA9IDIpIHsNCgkJLy8gUHJldmVudHMgZU1haWwgaGVhZGVyIGluamVjdGlvbnMNCgkJLy8gU291cmNlOiBodHRwOi8vd3d3LmVyaWNoLWthY2hl'));
	@fwrite($fp, base64_decode('bC5kZS8/cD0yNiAobW9kaWZpZWQpDQoNCgkJLyogcmVwbGFjZSB1bnRpbCBkb25lICovDQoJCSRmaWx0ZXJlZCA9IG51bGw7DQoJCXdoaWxlIChpc19udWxsKCRmaWx0ZXJlZCkgfHwgKCRwYXJhbV8gIT0gJGZpbHRlcmVkKSkgew0KCQkJaWYgKCFpc19udWxsKCRm'));
	@fwrite($fp, base64_decode('aWx0ZXJlZCkpIHsNCgkJCQkkcGFyYW1fID0gJGZpbHRlcmVkOw0KCQkJfQ0KDQoJCQkkZmlsdGVyZWQgPSBwcmVnX3JlcGxhY2UoIi8oQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZzp8TUlNRS1WZXJzaW9uOnxjb250ZW50LXR5cGU6fFN1YmplY3Q6fHRvOnxjYzp8'));
	@fwrite($fp, base64_decode('YmNjOnxmcm9tOnxyZXBseS10bzopL2ltcyIsICcnLCAkcGFyYW1fKTsNCgkJfQ0KDQoJCXVuc2V0KCRmaWx0ZXJlZCk7DQoNCgkJaWYgKCRsZXZlbF8gPj0gMikgew0KCQkJLyogcmVwbGFjZSB1bnRpbCBkb25lICovDQoJCQl3aGlsZSAoIWlzc2V0KCRmaWx0ZXJl'));
	@fwrite($fp, base64_decode('ZCkgfHwgKCRwYXJhbV8gIT0gJGZpbHRlcmVkKSkgew0KCQkJCWlmIChpc3NldCgkZmlsdGVyZWQpKSB7DQoJCQkJCSRwYXJhbV8gPSAkZmlsdGVyZWQ7DQoJCQkJfQ0KDQoJCQkJJGZpbHRlcmVkID0gcHJlZ19yZXBsYWNlKCIvKCUwQXxcXFxccnwlMER8XFxcXG58'));
	@fwrite($fp, base64_decode('JTAwfFxcXFwwfCUwOXxcXFxcdHwlMDF8JTAyfCUwM3wlMDR8JTA1fCUwNnwlMDd8JTA4fCUwOXwlMEJ8JTBDfCUwRXwlMEZ8JTEwfCUxMXwlMTJ8JTEzKS9pbXMiLCAnJywgJHBhcmFtXyk7DQoJCQl9DQoJCX0NCg0KCQlyZXR1cm4gJHBhcmFtXzsNCgl9DQoNCglw'));
	@fwrite($fp, base64_decode('cml2YXRlIGZ1bmN0aW9uIGdldEhlYWRlcnMoKSB7DQoJCXJldHVybiAkdGhpcy0+aGVhZGVyczsNCgl9DQoNCglwcml2YXRlIHN0YXRpYyBmdW5jdGlvbiBtYWlsX2Jhc2U2NF9lbmNvZGUoJHRleHQpIHsNCgkJLy8gV2h5IDcyPyBTZWVuIGhlcmU6IGh0dHA6Ly9s'));
	@fwrite($fp, base64_decode('aW51eC5kc3BsYWJzLmNvbS5hdS9tdW5wYWNrLW1pbWUtYmFzZTY0LW11bHRpLXBhcnQtYXR0YWNobWVudC1waHAtcGVybC1kZWNvZGUtZW1haWwtcGRmLXA4Mi8NCgkJcmV0dXJuIHdvcmR3cmFwKGJhc2U2NF9lbmNvZGUoJHRleHQpLCA3Miwgc2VsZjo6ZW5kbCwg'));
	@fwrite($fp, base64_decode('dHJ1ZSk7DQoJfQ0KDQoJcHJpdmF0ZSBmdW5jdGlvbiBoZWFkZXJMaW5lKCRuYW1lLCAkdmFsdWUpIHsNCgkJLy8gQ2hhbmdlIDIwMTEtMDItMDkNCgkJLy8gTEYgaXMgT0shIENSTEYgZG9lcyBsZWFkIHRvIENSK0NSTEYgb24gc29tZSBzeXN0ZW1zIQ0KCQkvLyBo'));
	@fwrite($fp, base64_decode('dHRwOi8vYnVncy5waHAubmV0L2J1Zy5waHA/aWQ9MTU4NDENCgkJLy8gVGhlIG1haWwoKSBmdW5jdGlvbiBpcyBub3QgdGFsa2luZyB0byBhbiBTTVRQIHNlcnZlciwgc28gUkZDMjgyMiBkb2VzIG5vdCBhcHBseSBoZXJlLiBtYWlsKCkgaXMgdGFsa2luZyB0byBh'));
	@fwrite($fp, base64_decode('IGNvbW1hbmQgbGluZSBwcm9ncmFtIG9uIHRoZSBsb2NhbCBzeXN0ZW0sIGFuZCBpdCBpcyByZWFzb25hYmxlIHRvIGV4cGVjdCB0aGF0IHByb2dyYW0gdG8gcmVxdWlyZSBzeXN0ZW0tbmF0aXZlIGxpbmUgYnJlYWtzLg0KCQlyZXR1cm4gJHRoaXMtPlFCX1NFQ1VS'));
	@fwrite($fp, base64_decode('RV9NQUlMX1BBUkFNKCRuYW1lKS4nOiAnLiR0aGlzLT5RQl9TRUNVUkVfTUFJTF9QQVJBTSgkdmFsdWUpLiJcbiI7DQoJfQ0KDQoJcHVibGljIGZ1bmN0aW9uIGFkZEhlYWRlcigkbmFtZSwgJHZhbHVlKSB7DQoJCSR0aGlzLT5oZWFkZXJzIC49ICR0aGlzLT5oZWFk'));
	@fwrite($fp, base64_decode('ZXJMaW5lKCRuYW1lLCAkdmFsdWUpOw0KCX0NCg0KCXB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gdXRmOFN1YmplY3QoJHN1YmplY3QpIHsNCgkJcmV0dXJuICc9P1VURi04P0I/Jy5iYXNlNjRfZW5jb2RlKHV0ZjhfZW5jb2RlKCRzdWJqZWN0KSkuJz89JzsNCgl9DQoN'));
	@fwrite($fp, base64_decode('Cglwcml2YXRlIGZ1bmN0aW9uIF9zZW5kTWFpbCgkcmVjaXBpZW50LCAkc3ViamVjdCwgJG1lc3NhZ2UsICRhZGRfaGVhZGVycz0nJykgew0KCQlyZXR1cm4gQG1haWwoDQoJCQkkdGhpcy0+UUJfU0VDVVJFX01BSUxfUEFSQU0oJHJlY2lwaWVudCksDQoJCQkkdGhp'));
	@fwrite($fp, base64_decode('cy0+UUJfU0VDVVJFX01BSUxfUEFSQU0oJHN1YmplY3QpLA0KCQkJJHRoaXMtPlFCX1NFQ1VSRV9NQUlMX1BBUkFNKCRtZXNzYWdlLCAxKSwNCgkJCSR0aGlzLT5nZXRIZWFkZXJzKCkuJGFkZF9oZWFkZXJzDQoJCSk7DQoJfQ0KDQoJcHVibGljIGZ1bmN0aW9uIHNl'));
	@fwrite($fp, base64_decode('bmRNYWlsKCRyZWNpcGllbnQsICRzdWJqZWN0LCAkbWVzc2FnZSkgew0KCQlyZXR1cm4gJHRoaXMtPl9zZW5kTWFpbCgkcmVjaXBpZW50LCAkc3ViamVjdCwgJG1lc3NhZ2UsICcnKTsNCgl9DQoNCgkvLyBUT0RPOiBwbGFpbiBhdXMgaHRtbCBiZXJlY2huZW4gYWxz'));
	@fwrite($fp, base64_decode('IG9wdGlvbmFsPw0KCXB1YmxpYyBmdW5jdGlvbiBzZW5kTWFpbEhUTUxhbmRQbGFpbk11bHRpcGFydCgkdG8sICRzdWJqZWN0LCAkbXNnX2h0bWwsICRtc2dfcGxhaW4pIHsNCgkJJGJvdW5kYXJ5ID0gdW5pcWlkKCducCcpOw0KDQoJCSRtc2dfaHRtbCAgPSAkdGhp'));
	@fwrite($fp, base64_decode('cy0+UUJfU0VDVVJFX01BSUxfUEFSQU0oJG1zZ19odG1sLCAgMSk7DQoJCSRtc2dfcGxhaW4gPSAkdGhpcy0+UUJfU0VDVVJFX01BSUxfUEFSQU0oJG1zZ19wbGFpbiwgMSk7DQoNCgkJJGFkZF9oZWFkZXJzICA9ICR0aGlzLT5oZWFkZXJMaW5lKCdNSU1FLVZlcnNp'));
	@fwrite($fp, base64_decode('b24nLCAnMS4wJyk7DQoJCSRhZGRfaGVhZGVycyAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgJ211bHRpcGFydC9hbHRlcm5hdGl2ZTsgYm91bmRhcnk9IicuJGJvdW5kYXJ5LiciJyk7DQoNCgkJJG1lc3NhZ2UgID0gIlRoaXMgaXMgYSBNSU1F'));
	@fwrite($fp, base64_decode('IGVuY29kZWQgbWVzc2FnZS4iOw0KCQkkbWVzc2FnZSAuPSBzZWxmOjplbmRsOw0KCQkkbWVzc2FnZSAuPSBzZWxmOjplbmRsOw0KCQkkbWVzc2FnZSAuPSAiLS0iIC4gJGJvdW5kYXJ5IC4gc2VsZjo6ZW5kbDsNCgkJJG1lc3NhZ2UgLj0gIkNvbnRlbnQtdHlwZTog'));
	@fwrite($fp, base64_decode('dGV4dC9wbGFpbjsgY2hhcnNldD11dGYtOCIuc2VsZjo6ZW5kbDsNCgkJJG1lc3NhZ2UgLj0gIkNvbnRlbnQtVHJhbnNmZXItRW5jb2Rpbmc6IGJhc2U2NCIuc2VsZjo6ZW5kbDsNCgkJJG1lc3NhZ2UgLj0gc2VsZjo6ZW5kbDsNCgkJJG1lc3NhZ2UgLj0gJHRoaXMt'));
	@fwrite($fp, base64_decode('Pm1haWxfYmFzZTY0X2VuY29kZSgkbXNnX3BsYWluKTsgLy8gYmV0dGVyIHRoYW4gd29yZHdyYXAmcXVvdGVkLXByaW50YWJsZSBiZWNhdXNlIG9mIGxvbmcgbGluZXMgKGUuZy4gbGlua3MpDQoJCSRtZXNzYWdlIC49IHNlbGY6OmVuZGw7DQoJCSRtZXNzYWdlIC49'));
	@fwrite($fp, base64_decode('IHNlbGY6OmVuZGw7DQoJCSRtZXNzYWdlIC49ICItLSIgLiAkYm91bmRhcnkgLiBzZWxmOjplbmRsOw0KCQkkbWVzc2FnZSAuPSAiQ29udGVudC10eXBlOiB0ZXh0L2h0bWw7IGNoYXJzZXQ9dXRmLTgiLnNlbGY6OmVuZGw7DQoJCSRtZXNzYWdlIC49ICJDb250ZW50'));
	@fwrite($fp, base64_decode('LVRyYW5zZmVyLUVuY29kaW5nOiBiYXNlNjQiLnNlbGY6OmVuZGw7DQoJCSRtZXNzYWdlIC49IHNlbGY6OmVuZGw7DQoJCSRtZXNzYWdlIC49ICR0aGlzLT5tYWlsX2Jhc2U2NF9lbmNvZGUoJG1zZ19odG1sKTsNCgkJJG1lc3NhZ2UgLj0gc2VsZjo6ZW5kbDsNCgkJ'));
	@fwrite($fp, base64_decode('JG1lc3NhZ2UgLj0gc2VsZjo6ZW5kbC4iLS0iIC4gJGJvdW5kYXJ5IC4gIi0tIjsNCg0KCQlyZXR1cm4gQG1haWwoDQoJCQkkdGhpcy0+UUJfU0VDVVJFX01BSUxfUEFSQU0oJHRvKSwNCgkJCSR0aGlzLT5RQl9TRUNVUkVfTUFJTF9QQVJBTSgkc3ViamVjdCksDQoJ'));
	@fwrite($fp, base64_decode('CQkkbWVzc2FnZSwNCgkJCSR0aGlzLT5nZXRIZWFkZXJzKCkuJGFkZF9oZWFkZXJzDQoJCSk7DQoJfQ0KfQ0K'));
	@fclose($fp);
}
if (!is_file('includes/classes/SecureMailer.class.php')) {
	warn('File has vanished! Will re-create it: includes/classes/SecureMailer.class.php');
	writefile_3();
	if (!is_file('includes/classes/SecureMailer.class.php')) {
		warn('File cannot be created (not existing): includes/classes/SecureMailer.class.php');
	} else if (sha1_file('includes/classes/SecureMailer.class.php') != 'e5f39b9de4c17f0a8dd4f6da12d8b962bd5323b9') {
		warn('File cannot be created (checksum mismatch): includes/classes/SecureMailer.class.php');
	} else if ((DIRECTORY_SEPARATOR === '/') && !@chmod('includes/classes/SecureMailer.class.php', 0644)) {
		warn('Could not change file permissions of includes/classes/SecureMailer.class.php');
	}
} else {
	if (@sha1_file('includes/classes/SecureMailer.class.php') !== 'e5f39b9de4c17f0a8dd4f6da12d8b962bd5323b9') {
		if (@sha1_file('includes/classes/SecureMailer.class.php') !== '93eab3425696191c1bcc9c4ad4f1411fb88ab7e2') {
			warn('File was modified. Will overwrite the changes now: includes/classes/SecureMailer.class.php');
			$tmp = pathinfo('includes/classes/SecureMailer.class.php');
			$backup_name = $tmp['dirname'].DIRECTORY_SEPARATOR.$tmp['filename'].'.'.date('Ymdhis',@filemtime('includes/classes/SecureMailer.class.php')).(isset($tmp['extension']) ? '.'.$tmp['extension'] : '');
			warn('Creating a backup as '.$backup_name);
			if (!@copy('includes/classes/SecureMailer.class.php', $backup_name)) {
				warn('Creation of backup failed');
			}
		}
		writefile_3();
		if (@sha1_file('includes/classes/SecureMailer.class.php') !== 'e5f39b9de4c17f0a8dd4f6da12d8b962bd5323b9') {
			warn('File cannot be written (checksum mismatch): includes/classes/SecureMailer.class.php');
		}
	}
}

// Files different: includes/functions.inc.php
function writefile_4() {
	@$fp = fopen('includes/functions.inc.php', 'w');
	@fwrite($fp, base64_decode('PD9waHAKCi8qCiAqIE9JRHBsdXMgMi4wCiAqIENvcHlyaWdodCAyMDE5IERhbmllbCBNYXJzY2hhbGwsIFZpYVRoaW5rU29mdAogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91'));
	@fwrite($fp, base64_decode('IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNF'));
	@fwrite($fp, base64_decode('TlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMs'));
	@fwrite($fp, base64_decode('CiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAq'));
	@fwrite($fp, base64_decode('IGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KCmZ1bmN0aW9uIGluc2VydFdoaXRlc3BhY2UoJHN0ciwgJGluZGV4KSB7CglyZXR1cm4gc3Vic3RyKCRzdHIsIDAsICRpbmRleCkgLiAnICcgLiBzdWJzdHIoJHN0ciwgJGluZGV4KTsKfQoKZnVuY3Rp'));
	@fwrite($fp, base64_decode('b24ganNfZXNjYXBlKCRkYXRhKSB7CgkvLyBUT0RPLi4uLiBqc29uX2VuY29kZT8/CgkkZGF0YSA9IHN0cl9yZXBsYWNlKCdcXCcsICdcXFxcJywgJGRhdGEpOwoJJGRhdGEgPSBzdHJfcmVwbGFjZSgnXCcnLCAnXFxcJycsICRkYXRhKTsKCXJldHVybiAiJyIgLiAk'));
	@fwrite($fp, base64_decode('ZGF0YSAuICInIjsKfQoKZnVuY3Rpb24gdHJpbV9icigkaHRtbCkgewoJJGNvdW50ID0gMDsKCWRvIHsgJGh0bWwgPSBwcmVnX3JlcGxhY2UoJ0BeXHMqPFxzKmJyXHMqL3swLDF9XHMqPkBpc1UnLCAnJywgJGh0bWwsIC0xLCAkY291bnQpOyB9IHdoaWxlICgkY291'));
	@fwrite($fp, base64_decode('bnQgPiAwKTsgLy8gbGVmdCB0cmltCglkbyB7ICRodG1sID0gcHJlZ19yZXBsYWNlKCdAPFxzKmJyXHMqL3swLDF9XHMqPlxzKiRAaXNVJywgJycsICRodG1sLCAtMSwgJGNvdW50KTsgfSB3aGlsZSAoJGNvdW50ID4gMCk7IC8vIHJpZ2h0IHRyaW0KCXJldHVybiAk'));
	@fwrite($fp, base64_decode('aHRtbDsKfQoKZnVuY3Rpb24gdmVyaWZ5X3ByaXZhdGVfcHVibGljX2tleSgkcHJpdktleSwgJHB1YktleSkgewoJdHJ5IHsKCQlpZiAoZW1wdHkoJHByaXZLZXkpKSByZXR1cm4gZmFsc2U7CgkJaWYgKGVtcHR5KCRwdWJLZXkpKSByZXR1cm4gZmFsc2U7CgkJJGRh'));
	@fwrite($fp, base64_decode('dGEgPSAnVEVTVCc7CgkJJGVuY3J5cHRlZCA9ICcnOwoJCSRkZWNyeXB0ZWQgPSAnJzsKCQlpZiAoIUBvcGVuc3NsX3B1YmxpY19lbmNyeXB0KCRkYXRhLCAkZW5jcnlwdGVkLCAkcHViS2V5KSkgcmV0dXJuIGZhbHNlOwoJCWlmICghQG9wZW5zc2xfcHJpdmF0ZV9k'));
	@fwrite($fp, base64_decode('ZWNyeXB0KCRlbmNyeXB0ZWQsICRkZWNyeXB0ZWQsICRwcml2S2V5KSkgcmV0dXJuIGZhbHNlOwoJCXJldHVybiAkZGVjcnlwdGVkID09ICRkYXRhOwoJfSBjYXRjaCAoRXhjZXB0aW9uICRlKSB7CgkJcmV0dXJuIGZhbHNlOwoJfQp9CgpmdW5jdGlvbiBzbWFsbGhh'));
	@fwrite($fp, base64_decode('c2goJGRhdGEpIHsgLy8gZ2V0IDMxIGJpdHMgZnJvbSBTSEExLiBWYWx1ZXMgMC4uMjE0NzQ4MzY0NwoJcmV0dXJuIChoZXhkZWMoc3Vic3RyKHNoYTEoJGRhdGEpLC00KjIpKSAmIDB4N0ZGRkZGRkYpOwp9CgpmdW5jdGlvbiBzcGxpdF9maXJzdG5hbWVfbGFzdG5h'));
	@fwrite($fp, base64_decode('bWUoJG5hbWUpIHsKCSRhcnkgPSBleHBsb2RlKCcgJywgJG5hbWUpOwoJJGxhc3RfbmFtZSA9IGFycmF5X3BvcCgkYXJ5KTsKCSRmaXJzdF9uYW1lID0gaW1wbG9kZSgnICcsICRhcnkpOwoJcmV0dXJuIGFycmF5KCRmaXJzdF9uYW1lLCAkbGFzdF9uYW1lKTsKfQoK'));
	@fwrite($fp, base64_decode('ZnVuY3Rpb24gb3JpZ2luSGVhZGVycygpIHsKCS8vIENPUlMKCS8vIEF1dGhvcjogVGlsbCBXZWhvd3NraQoKCWhlYWRlcigiQWNjZXNzLUNvbnRyb2wtQWxsb3ctQ3JlZGVudGlhbHM6IHRydWUiKTsKCWhlYWRlcigiQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2lu'));
	@fwrite($fp, base64_decode('OiAiLnN0cmlwX3RhZ3MoKChpc3NldCgkX1NFUlZFUlsnSFRUUF9PUklHSU4nXSkpID8gJF9TRVJWRVJbJ0hUVFBfT1JJR0lOJ10gOiAiKiIpKSk7CgoJaGVhZGVyKCJBY2Nlc3MtQ29udHJvbC1BbGxvdy1IZWFkZXJzOiBJZi1Ob25lLU1hdGNoLCBYLVJlcXVlc3Rl'));
	@fwrite($fp, base64_decode('ZC1XaXRoLCBPcmlnaW4sIFgtRnJkbHdlYi1CdWdzLCBFdGFnLCBYLUZvcmdlcnktUHJvdGVjdGlvbi1Ub2tlbiwgWC1DU1JGLVRva2VuIik7CgoJaWYgKGlzc2V0KCRfU0VSVkVSWydIVFRQX09SSUdJTiddKSkgewoJCWhlYWRlcignWC1GcmFtZS1PcHRpb25zOiBB'));
	@fwrite($fp, base64_decode('TExPVy1GUk9NICcuJF9TRVJWRVJbJ0hUVFBfT1JJR0lOJ10pOwoJfSBlbHNlIHsKCQloZWFkZXJfcmVtb3ZlKCJYLUZyYW1lLU9wdGlvbnMiKTsKCX0KCgkkZXhwb3NlID0gYXJyYXkoJ0V0YWcnLCAnWC1DU1JGLVRva2VuJyk7Cglmb3JlYWNoIChoZWFkZXJzX2xp'));
	@fwrite($fp, base64_decode('c3QoKSBhcyAkbnVtID0+ICRoZWFkZXIpIHsKCQkkaCA9IGV4cGxvZGUoJzonLCAkaGVhZGVyKTsKCQkkZXhwb3NlW10gPSB0cmltKCRoWzBdKTsKCX0KCWhlYWRlcigiQWNjZXNzLUNvbnRyb2wtRXhwb3NlLUhlYWRlcnM6ICIuaW1wbG9kZSgnLCcsJGV4cG9zZSkp'));
	@fwrite($fp, base64_decode('OwoKCWhlYWRlcigiVmFyeTogT3JpZ2luIik7Cn0KCmZ1bmN0aW9uIGdldF9jYWxsaW5nX2Z1bmN0aW9uKCkgewoJJGV4ID0gbmV3IEV4Y2VwdGlvbigpOwoJJHRyYWNlID0gJGV4LT5nZXRUcmFjZSgpOwoJaWYgKCFpc3NldCgkdHJhY2VbMl0pKSByZXR1cm4gX0wo'));
	@fwrite($fp, base64_decode('JyhtYWluKScpOwoJJGZpbmFsX2NhbGwgPSAkdHJhY2VbMl07CglyZXR1cm4gJGZpbmFsX2NhbGxbJ2ZpbGUnXS4nOicuJGZpbmFsX2NhbGxbJ2xpbmUnXS4nLycuJGZpbmFsX2NhbGxbJ2Z1bmN0aW9uJ10uJygpJzsKfQoKaWYgKCFmdW5jdGlvbl9leGlzdHMoJ21i'));
	@fwrite($fp, base64_decode('X3dvcmR3cmFwJykpIHsKCWZ1bmN0aW9uIG1iX3dvcmR3cmFwKCRzdHIsICR3aWR0aCA9IDc1LCAkYnJlYWsgPSAiXG4iLCAkY3V0ID0gZmFsc2UpIHsKCQkvLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL2EvNDk4ODQ5NC80ODg1MzkKCQkkbGluZXMgPSBleHBs'));
	@fwrite($fp, base64_decode('b2RlKCRicmVhaywgJHN0cik7CgkJZm9yZWFjaCAoJGxpbmVzIGFzICYkbGluZSkgewoJCQkkbGluZSA9IHJ0cmltKCRsaW5lKTsKCQkJaWYgKG1iX3N0cmxlbigkbGluZSkgPD0gJHdpZHRoKSB7CgkJCQljb250aW51ZTsKCQkJfQoJCQkkd29yZHMgPSBleHBsb2Rl'));
	@fwrite($fp, base64_decode('KCcgJywgJGxpbmUpOwoJCQkkbGluZSA9ICcnOwoJCQkkYWN0dWFsID0gJyc7CgkJCWZvcmVhY2ggKCR3b3JkcyBhcyAkd29yZCkgewoJCQkJaWYgKG1iX3N0cmxlbigkYWN0dWFsLiR3b3JkKSA8PSAkd2lkdGgpIHsKCQkJCQkkYWN0dWFsIC49ICR3b3JkLicgJzsK'));
	@fwrite($fp, base64_decode('CQkJCX0gZWxzZSB7CgkJCQkJaWYgKCRhY3R1YWwgIT0gJycpIHsKCQkJCQkJJGxpbmUgLj0gcnRyaW0oJGFjdHVhbCkuJGJyZWFrOwoJCQkJCX0KCQkJCQkkYWN0dWFsID0gJHdvcmQ7CgkJCQkJaWYgKCRjdXQpIHsKCQkJCQkJd2hpbGUgKG1iX3N0cmxlbigkYWN0'));
	@fwrite($fp, base64_decode('dWFsKSA+ICR3aWR0aCkgewoJCQkJCQkJJGxpbmUgLj0gbWJfc3Vic3RyKCRhY3R1YWwsIDAsICR3aWR0aCkuJGJyZWFrOwoJCQkJCQkJJGFjdHVhbCA9IG1iX3N1YnN0cigkYWN0dWFsLCAkd2lkdGgpOwoJCQkJCQl9CgkJCQkJfQoJCQkJCSRhY3R1YWwgLj0gJyAn'));
	@fwrite($fp, base64_decode('OwoJCQkJfQoJCQl9CgkJCSRsaW5lIC49IHRyaW0oJGFjdHVhbCk7CgkJfQoJCXJldHVybiBpbXBsb2RlKCRicmVhaywgJGxpbmVzKTsKCX0KfQoKZnVuY3Rpb24gaHR0cE91dFdpdGhFVGFnKCRvdXQsICRjb250ZW50VHlwZSwgJGZpbGVuYW1lPScnKSB7CgkkZXRh'));
	@fwrite($fp, base64_decode('ZyA9IG1kNSgkb3V0KTsKCWhlYWRlcigiRXRhZzogJGV0YWciKTsKCWhlYWRlcigiQ29udGVudC1NRDU6ICRldGFnIik7IC8vIFJGQyAyNjE2IGNsYXVzZSAxNC4xNQoJaWYgKGlzc2V0KCRfU0VSVkVSWydIVFRQX0lGX05PTkVfTUFUQ0gnXSkgJiYgKHRyaW0oJF9T'));
	@fwrite($fp, base64_decode('RVJWRVJbJ0hUVFBfSUZfTk9ORV9NQVRDSCddKSA9PSAkZXRhZykpIHsKCQloZWFkZXIoIkhUVFAvMS4xIDMwNCBOb3QgTW9kaWZpZWQiKTsKCX0gZWxzZSB7CgkJaGVhZGVyKCJDb250ZW50LVR5cGU6ICRjb250ZW50VHlwZSIpOwoJCWlmICghZW1wdHkoJGZpbGVu'));
	@fwrite($fp, base64_decode('YW1lKSkgewoJCQloZWFkZXIoJ0NvbnRlbnQtRGlzcG9zaXRpb246aW5saW5lOyBmaWxlbmFtZT0iJy4kZmlsZW5hbWUuJyInKTsKCQl9CgkJZWNobyAkb3V0OwoJfQoJZGllKCk7Cn0KCmZ1bmN0aW9uIG15X3ZzcHJpbnRmKCRzdHIsICRhcmdzKSB7CiAgICAgICAg'));
	@fwrite($fp, base64_decode('JG4gPSAxOwogICAgICAgIGZvcmVhY2ggKCRhcmdzIGFzICR2YWwpIHsKICAgICAgICAgICAgICAgICRzdHIgPSBzdHJfcmVwbGFjZSgiJSRuIiwgJHZhbCwgJHN0cik7CiAgICAgICAgICAgICAgICAkbisrOwogICAgICAgIH0KICAgICAgICAkc3RyID0gc3RyX3Jl'));
	@fwrite($fp, base64_decode('cGxhY2UoIiUlIiwgIiUiLCAkc3RyKTsKICAgICAgICByZXR1cm4gJHN0cjsKfQoKZnVuY3Rpb24gX0woJHN0ciwgLi4uJHNwcmludGZBcmdzKSB7CgkkbGFuZyA9IE9JRHBsdXM6OmdldEN1cnJlbnRMYW5nKCk7CgoJc3RhdGljICR0cmFuc2xhdGlvbl9hcnJheSA9'));
	@fwrite($fp, base64_decode('IGFycmF5KCk7CglzdGF0aWMgJHRyYW5zbGF0aW9uX2xvYWRlZCA9IG51bGw7CglpZiAoJGxhbmcgIT0gJHRyYW5zbGF0aW9uX2xvYWRlZCkgewoJCSRnb29kID0gdHJ1ZTsKCQlpZiAoc3RycG9zKCRsYW5nLCcvJykgIT09IGZhbHNlKSAkZ29vZCA9IGZhbHNlOyAv'));
	@fwrite($fp, base64_decode('LyBwcmV2ZW50IGF0dGFjayAoYnV0IGFjdHVhbGx5LCB0aGUgc2FuaXRpemF0aW9uIGluIGdldEN1cnJlbnRMYW5nIHNob3VsZCB3b3JrKQoJCWlmIChzdHJwb3MoJGxhbmcsJ1xcJykgIT09IGZhbHNlKSAkZ29vZCA9IGZhbHNlOyAvLyBwcmV2ZW50IGF0dGFjayAo'));
	@fwrite($fp, base64_decode('YnV0IGFjdHVhbGx5LCB0aGUgc2FuaXRpemF0aW9uIGluIGdldEN1cnJlbnRMYW5nIHNob3VsZCB3b3JrKQoJCWlmIChzdHJwb3MoJGxhbmcsJy4uJykgIT09IGZhbHNlKSAkZ29vZCA9IGZhbHNlOyAvLyBwcmV2ZW50IGF0dGFjayAoYnV0IGFjdHVhbGx5LCB0aGUg'));
	@fwrite($fp, base64_decode('c2FuaXRpemF0aW9uIGluIGdldEN1cnJlbnRMYW5nIHNob3VsZCB3b3JrKQoJCSR0cmFuc2xhdGlvbl9maWxlID0gX19ESVJfXy4nLy4uL3BsdWdpbnMvbGFuZ3VhZ2UvJy4kbGFuZy4nL21lc3NhZ2VzLnhtbCc7CgkJaWYgKCRnb29kICYmICFmaWxlX2V4aXN0cygk'));
	@fwrite($fp, base64_decode('dHJhbnNsYXRpb25fZmlsZSkpICRnb29kID0gZmFsc2U7CgkJaWYgKCRnb29kKSB7CgkJCSR4bWwgPSBzaW1wbGV4bWxfbG9hZF9zdHJpbmcoZmlsZV9nZXRfY29udGVudHMoJHRyYW5zbGF0aW9uX2ZpbGUpKTsKCQkJZm9yZWFjaCAoJHhtbC0+bWVzc2FnZSBhcyAk'));
	@fwrite($fp, base64_decode('bXNnKSB7CgkJCQkkc3JjID0gdHJpbSgkbXNnLT5zb3VyY2UtPl9fdG9TdHJpbmcoKSk7CgkJCQkkZHN0ID0gdHJpbSgkbXNnLT50YXJnZXQtPl9fdG9TdHJpbmcoKSk7CgkJCQkkdHJhbnNsYXRpb25fYXJyYXlbJHNyY10gPSAkZHN0OwoJCQl9CgkJCSR0cmFuc2xh'));
	@fwrite($fp, base64_decode('dGlvbl9sb2FkZWQgPSAkbGFuZzsKCQl9Cgl9CgoJaWYgKCRsYW5nICE9ICR0cmFuc2xhdGlvbl9sb2FkZWQpIHsKCQkvLyBTb21ldGhpbmcgYmFkIGhhcHBlbmVkIChlLmcuIGF0dGFjayBvciBtZXNzYWdlIGZpbGUgbm90IGZvdW5kKQoJCSRyZXMgPSAkc3RyOwoJ'));
	@fwrite($fp, base64_decode('fSBlbHNlIHsKCQkkcmVzID0gaXNzZXQoJHRyYW5zbGF0aW9uX2FycmF5WyRzdHJdKSAmJiAhZW1wdHkoJHRyYW5zbGF0aW9uX2FycmF5WyRzdHJdKSA/ICR0cmFuc2xhdGlvbl9hcnJheVskc3RyXSA6ICRzdHI7Cgl9CgoJJHJlcyA9IHN0cl9yZXBsYWNlKCcjIyMn'));
	@fwrite($fp, base64_decode('LCBPSURwbHVzOjpiYXNlQ29uZmlnKCktPmdldFZhbHVlKCdUQUJMRU5BTUVfUFJFRklYJywgJycpLCAkcmVzKTsKCgkkcmVzID0gbXlfdnNwcmludGYoJHJlcywgJHNwcmludGZBcmdzKTsKCglyZXR1cm4gJHJlczsKfQoKZnVuY3Rpb24gZXh0cmFjdEh0bWxDb250'));
	@fwrite($fp, base64_decode('ZW50cygkY29udCkgewoJLy8gbWFrZSBzdXJlIHRoZSBwcm9ncmFtIHdvcmtzIGV2ZW4gaWYgdGhlIHVzZXIgcHJvdmlkZWQgSFRNTCBpcyBub3QgVVRGLTgKCSRjb250ID0gaWNvbnYobWJfZGV0ZWN0X2VuY29kaW5nKCRjb250LCBtYl9kZXRlY3Rfb3JkZXIoKSwg'));
	@fwrite($fp, base64_decode('dHJ1ZSksICdVVEYtOC8vSUdOT1JFJywgJGNvbnQpOwoJJGJvbSA9IHBhY2soJ0gqJywnRUZCQkJGJyk7CgkkY29udCA9IHByZWdfcmVwbGFjZSgiL14kYm9tLyIsICcnLCAkY29udCk7CgoJJG91dF9qcyA9ICcnOwoJJG0gPSBhcnJheSgpOwoJcHJlZ19tYXRjaF9h'));
	@fwrite($fp, base64_decode('bGwoJ0A8c2NyaXB0W14+XSo+KC4rKTwvc2NyaXB0PkBpc21VJywgJGNvbnQsICRtKTsKCWZvcmVhY2ggKCRtWzFdIGFzICR4KSB7CgkJJG91dF9qcyA9ICR4IC4gIlxuXG4iOwoJfQoKCSRvdXRfY3NzID0gJyc7CgkkbSA9IGFycmF5KCk7CglwcmVnX21hdGNoX2Fs'));
	@fwrite($fp, base64_decode('bCgnQDxzdHlsZVtePl0qPiguKyk8L3N0eWxlPkBpc21VJywgJGNvbnQsICRtKTsKCWZvcmVhY2ggKCRtWzFdIGFzICR4KSB7CgkJJG91dF9jc3MgPSAkeCAuICJcblxuIjsKCX0KCgkkb3V0X2h0bWwgPSAkY29udDsKCSRvdXRfaHRtbCA9IHByZWdfcmVwbGFjZSgn'));
	@fwrite($fp, base64_decode('QF4oLispPGJvZHlbXj5dKj5AaXNVJywgJycsICRvdXRfaHRtbCk7Cgkkb3V0X2h0bWwgPSBwcmVnX3JlcGxhY2UoJ0A8L2JvZHk+LiskQGlzVScsICcnLCAkb3V0X2h0bWwpOwoJJG91dF9odG1sID0gcHJlZ19yZXBsYWNlKCdAPHRpdGxlPi4rPC90aXRsZT5AaXNV'));
	@fwrite($fp, base64_decode('JywgJycsICRvdXRfaHRtbCk7Cgkkb3V0X2h0bWwgPSBwcmVnX3JlcGxhY2UoJ0A8aDE+Lis8L2gxPkBpc1UnLCAnJywgJG91dF9odG1sLCAxKTsKCSRvdXRfaHRtbCA9IHByZWdfcmVwbGFjZSgnQDxzY3JpcHRbXj5dKj4oLispPC9zY3JpcHQ+QGlzbVUnLCAnJywg'));
	@fwrite($fp, base64_decode('JG91dF9odG1sKTsKCSRvdXRfaHRtbCA9IHByZWdfcmVwbGFjZSgnQDxzdHlsZVtePl0qPiguKyk8L3N0eWxlPkBpc21VJywgJycsICRvdXRfaHRtbCk7CgoJcmV0dXJuIGFycmF5KCRvdXRfaHRtbCwgJG91dF9qcywgJG91dF9jc3MpOwp9CgpmdW5jdGlvbiBzaGEz'));
	@fwrite($fp, base64_decode('XzUxMigkcGFzc3dvcmQsICRyYXdfb3V0cHV0PWZhbHNlKSB7CglpZiAodmVyc2lvbl9jb21wYXJlKFBIUF9WRVJTSU9OLCAnNy4xLjAnKSA+PSAwKSB7CgkJcmV0dXJuIGhhc2goJ3NoYTMtNTEyJywgJHBhc3N3b3JkLCAkcmF3X291dHB1dCk7Cgl9IGVsc2UgewoJ'));
	@fwrite($fp, base64_decode('CXJldHVybiBiYlxTaGEzXFNoYTM6Omhhc2goJHBhc3N3b3JkLCA1MTIsICRyYXdfb3V0cHV0KTsKCX0KfQo='));
	@fclose($fp);
}
if (!is_file('includes/functions.inc.php')) {
	warn('File has vanished! Will re-create it: includes/functions.inc.php');
	writefile_4();
	if (!is_file('includes/functions.inc.php')) {
		warn('File cannot be created (not existing): includes/functions.inc.php');
	} else if (sha1_file('includes/functions.inc.php') != '29c73cde447cdc92f56b27b4713dea78c2397342') {
		warn('File cannot be created (checksum mismatch): includes/functions.inc.php');
	} else if ((DIRECTORY_SEPARATOR === '/') && !@chmod('includes/functions.inc.php', 0644)) {
		warn('Could not change file permissions of includes/functions.inc.php');
	}
} else {
	if (@sha1_file('includes/functions.inc.php') !== '29c73cde447cdc92f56b27b4713dea78c2397342') {
		if (@sha1_file('includes/functions.inc.php') !== '6580d135f5514d25d78ce4313812a7b4e377fa04') {
			warn('File was modified. Will overwrite the changes now: includes/functions.inc.php');
			$tmp = pathinfo('includes/functions.inc.php');
			$backup_name = $tmp['dirname'].DIRECTORY_SEPARATOR.$tmp['filename'].'.'.date('Ymdhis',@filemtime('includes/functions.inc.php')).(isset($tmp['extension']) ? '.'.$tmp['extension'] : '');
			warn('Creating a backup as '.$backup_name);
			if (!@copy('includes/functions.inc.php', $backup_name)) {
				warn('Creation of backup failed');
			}
		}
		writefile_4();
		if (@sha1_file('includes/functions.inc.php') !== '29c73cde447cdc92f56b27b4713dea78c2397342') {
			warn('File cannot be written (checksum mismatch): includes/functions.inc.php');
		}
	}
}

// Files different: plugins/auth/A2_sha3_salted_base64/OIDplusAuthPluginSha3SaltedBase64.class.php
function writefile_5() {
	@$fp = fopen('plugins/auth/A2_sha3_salted_base64/OIDplusAuthPluginSha3SaltedBase64.class.php', 'w');
	@fwrite($fp, base64_decode('PD9waHAKCi8qCiAqIE9JRHBsdXMgMi4wCiAqIENvcHlyaWdodCAyMDIwIERhbmllbCBNYXJzY2hhbGwsIFZpYVRoaW5rU29mdAogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91'));
	@fwrite($fp, base64_decode('IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNF'));
	@fwrite($fp, base64_decode('TlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMs'));
	@fwrite($fp, base64_decode('CiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAq'));
	@fwrite($fp, base64_decode('IGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KCmNsYXNzIE9JRHBsdXNBdXRoUGx1Z2luU2hhM1NhbHRlZEJhc2U2NCBleHRlbmRzIE9JRHBsdXNBdXRoUGx1Z2luIHsKCglwdWJsaWMgZnVuY3Rpb24gdmVyaWZ5KCRhdXRoS2V5LCAkc2FsdCwgJGNo'));
	@fwrite($fp, base64_decode('ZWNrX3Bhc3N3b3JkKSB7CgkJQGxpc3QoJHNfYXV0aG1ldGhvZCwgJHNfYXV0aGtleSkgPSBleHBsb2RlKCcjJywgJGF1dGhLZXksIDIpOwoKCQlpZiAoJHNfYXV0aG1ldGhvZCA9PSAnQTInKSB7CgkJCS8vIERlZmF1bHQgT0lEcGx1cyAyLjAgYmVoYXZpb3IKCQkJ'));
	@fwrite($fp, base64_decode('Ly8gQTIjWCB3aXRoIFggYmVpbmcgc2hhM3tiYXNlNjR9KHNhbHQrcGFzc3dvcmQpCgkJCSRjYWxjX2F1dGhrZXkgPSBiYXNlNjRfZW5jb2RlKHNoYTNfNTEyKCRzYWx0LiRjaGVja19wYXNzd29yZCwgdHJ1ZSkpOwoJCX0gZWxzZSB7CgkJCS8vIEludmFsaWQgYXV0'));
	@fwrite($fp, base64_decode('aCBjb2RlCgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCXJldHVybiBoYXNoX2VxdWFscygkY2FsY19hdXRoa2V5LCAkc19hdXRoa2V5KTsKCX0KCn0K'));
	@fclose($fp);
}
if (!is_file('plugins/auth/A2_sha3_salted_base64/OIDplusAuthPluginSha3SaltedBase64.class.php')) {
	warn('File has vanished! Will re-create it: plugins/auth/A2_sha3_salted_base64/OIDplusAuthPluginSha3SaltedBase64.class.php');
	writefile_5();
	if (!is_file('plugins/auth/A2_sha3_salted_base64/OIDplusAuthPluginSha3SaltedBase64.class.php')) {
		warn('File cannot be created (not existing): plugins/auth/A2_sha3_salted_base64/OIDplusAuthPluginSha3SaltedBase64.class.php');
	} else if (sha1_file('plugins/auth/A2_sha3_salted_base64/OIDplusAuthPluginSha3SaltedBase64.class.php') != 'ba74ac973c2cc3d4b37792f03579ec06e921076a') {
		warn('File cannot be created (checksum mismatch): plugins/auth/A2_sha3_salted_base64/OIDplusAuthPluginSha3SaltedBase64.class.php');
	} else if ((DIRECTORY_SEPARATOR === '/') && !@chmod('plugins/auth/A2_sha3_salted_base64/OIDplusAuthPluginSha3SaltedBase64.class.php', 0644)) {
		warn('Could not change file permissions of plugins/auth/A2_sha3_salted_base64/OIDplusAuthPluginSha3SaltedBase64.class.php');
	}
} else {
	if (@sha1_file('plugins/auth/A2_sha3_salted_base64/OIDplusAuthPluginSha3SaltedBase64.class.php') !== 'ba74ac973c2cc3d4b37792f03579ec06e921076a') {
		if (@sha1_file('plugins/auth/A2_sha3_salted_base64/OIDplusAuthPluginSha3SaltedBase64.class.php') !== '419d565fd92ce9380b5715f7579119bd712042fa') {
			warn('File was modified. Will overwrite the changes now: plugins/auth/A2_sha3_salted_base64/OIDplusAuthPluginSha3SaltedBase64.class.php');
			$tmp = pathinfo('plugins/auth/A2_sha3_salted_base64/OIDplusAuthPluginSha3SaltedBase64.class.php');
			$backup_name = $tmp['dirname'].DIRECTORY_SEPARATOR.$tmp['filename'].'.'.date('Ymdhis',@filemtime('plugins/auth/A2_sha3_salted_base64/OIDplusAuthPluginSha3SaltedBase64.class.php')).(isset($tmp['extension']) ? '.'.$tmp['extension'] : '');
			warn('Creating a backup as '.$backup_name);
			if (!@copy('plugins/auth/A2_sha3_salted_base64/OIDplusAuthPluginSha3SaltedBase64.class.php', $backup_name)) {
				warn('Creation of backup failed');
			}
		}
		writefile_5();
		if (@sha1_file('plugins/auth/A2_sha3_salted_base64/OIDplusAuthPluginSha3SaltedBase64.class.php') !== 'ba74ac973c2cc3d4b37792f03579ec06e921076a') {
			warn('File cannot be written (checksum mismatch): plugins/auth/A2_sha3_salted_base64/OIDplusAuthPluginSha3SaltedBase64.class.php');
		}
	}
}


file_put_contents('oidplus_version.txt', "Revision 400\n");
if (trim(@file_get_contents('oidplus_version.txt')) !== 'Revision 400') err('Could not write to oidplus_version.txt!');


echo 'DONE'; // This exact string will be compared in Update v3

@unlink(__FILE__);
if (is_file(__FILE__)) warn('Could not delete '.basename(__FILE__).'! Please delete it manually');

